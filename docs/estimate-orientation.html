<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>4 Estimate orientation | Detecting Hexadirectional Signals in the Human Brain using R and FSL</title>
  <meta name="description" content="4 Estimate orientation | Detecting Hexadirectional Signals in the Human Brain using R and FSL" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="4 Estimate orientation | Detecting Hexadirectional Signals in the Human Brain using R and FSL" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="4 Estimate orientation | Detecting Hexadirectional Signals in the Human Brain using R and FSL" />
  
  
  

<meta name="author" content="Jacob Bellmund" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="glm-1.html"/>
<link rel="next" href="glm-2.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements"><i class="fa fa-check"></i><b>1.1</b> Requirements</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#workflow"><i class="fa fa-check"></i><b>1.2</b> Workflow</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#cbs-imac-or-macbook"><i class="fa fa-check"></i><b>1.2.1</b> CBS iMac or Macbook</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#remote-linux"><i class="fa fa-check"></i><b>1.2.2</b> Remote Linux</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#running-the-analysis"><i class="fa fa-check"></i><b>1.2.3</b> Running the analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#required-packages"><i class="fa fa-check"></i><b>1.3</b> Required packages</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="example-data.html"><a href="example-data.html"><i class="fa fa-check"></i><b>2</b> Example Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="example-data.html"><a href="example-data.html#download-example-data"><i class="fa fa-check"></i><b>2.1</b> Download Example Data</a></li>
<li class="chapter" data-level="2.2" data-path="example-data.html"><a href="example-data.html#rearrange-data"><i class="fa fa-check"></i><b>2.2</b> Rearrange data</a></li>
<li class="chapter" data-level="2.3" data-path="example-data.html"><a href="example-data.html#event-tables"><i class="fa fa-check"></i><b>2.3</b> Event Tables</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="example-data.html"><a href="example-data.html#trajectory-duration"><i class="fa fa-check"></i><b>2.3.1</b> Trajectory duration</a></li>
<li class="chapter" data-level="2.3.2" data-path="example-data.html"><a href="example-data.html#angular-sampling"><i class="fa fa-check"></i><b>2.3.2</b> Angular Sampling</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="example-data.html"><a href="example-data.html#fmri"><i class="fa fa-check"></i><b>2.4</b> fMRI</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="example-data.html"><a href="example-data.html#merge-images-of-each-run"><i class="fa fa-check"></i><b>2.4.1</b> Merge images of each run</a></li>
<li class="chapter" data-level="2.4.2" data-path="example-data.html"><a href="example-data.html#calculate-tsnr"><i class="fa fa-check"></i><b>2.4.2</b> Calculate tSNR</a></li>
<li class="chapter" data-level="2.4.3" data-path="example-data.html"><a href="example-data.html#create-quick-brain-mask"><i class="fa fa-check"></i><b>2.4.3</b> Create quick brain mask</a></li>
<li class="chapter" data-level="2.4.4" data-path="example-data.html"><a href="example-data.html#mask-4d-functionals"><i class="fa fa-check"></i><b>2.4.4</b> Mask 4D functionals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="glm-1.html"><a href="glm-1.html"><i class="fa fa-check"></i><b>3</b> GLM 1</a>
<ul>
<li class="chapter" data-level="3.1" data-path="glm-1.html"><a href="glm-1.html#first-half-of-each-run"><i class="fa fa-check"></i><b>3.1</b> First half of each run</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="glm-1.html"><a href="glm-1.html#ev-files-for-feat"><i class="fa fa-check"></i><b>3.1.1</b> EV files for FEAT</a></li>
<li class="chapter" data-level="3.1.2" data-path="glm-1.html"><a href="glm-1.html#set-up-the-glm-using-fsl-feat"><i class="fa fa-check"></i><b>3.1.2</b> Set up the GLM using FSL FEAT</a></li>
<li class="chapter" data-level="3.1.3" data-path="glm-1.html"><a href="glm-1.html#run-glm1"><i class="fa fa-check"></i><b>3.1.3</b> Run GLM1</a></li>
<li class="chapter" data-level="3.1.4" data-path="glm-1.html"><a href="glm-1.html#results-glm-1"><i class="fa fa-check"></i><b>3.1.4</b> Results GLM 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="estimate-orientation.html"><a href="estimate-orientation.html"><i class="fa fa-check"></i><b>4</b> Estimate orientation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="estimate-orientation.html"><a href="estimate-orientation.html#load-pes-of-parametric-modulators"><i class="fa fa-check"></i><b>4.1</b> Load PEs of parametric modulators</a></li>
<li class="chapter" data-level="4.2" data-path="estimate-orientation.html"><a href="estimate-orientation.html#compute-voxelwise-orientation"><i class="fa fa-check"></i><b>4.2</b> Compute Voxelwise Orientation</a></li>
<li class="chapter" data-level="4.3" data-path="estimate-orientation.html"><a href="estimate-orientation.html#average-grid-orientations"><i class="fa fa-check"></i><b>4.3</b> Average grid orientations</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="estimate-orientation.html"><a href="estimate-orientation.html#wholebrain-average-orientation"><i class="fa fa-check"></i><b>4.3.1</b> Wholebrain average orientation</a></li>
<li class="chapter" data-level="4.3.2" data-path="estimate-orientation.html"><a href="estimate-orientation.html#entorhinal-cortex-average-orientation"><i class="fa fa-check"></i><b>4.3.2</b> Entorhinal Cortex average orientation</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="estimate-orientation.html"><a href="estimate-orientation.html#brain-plot-of-estimated-orientations"><i class="fa fa-check"></i><b>4.4</b> Brain plot of estimated orientations</a></li>
<li class="chapter" data-level="4.5" data-path="estimate-orientation.html"><a href="estimate-orientation.html#store-estimated-grid-orientation"><i class="fa fa-check"></i><b>4.5</b> Store estimated grid orientation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="glm-2.html"><a href="glm-2.html"><i class="fa fa-check"></i><b>5</b> GLM 2</a>
<ul>
<li class="chapter" data-level="5.1" data-path="glm-2.html"><a href="glm-2.html#second-half-of-each-run"><i class="fa fa-check"></i><b>5.1</b> Second half of each run</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="glm-2.html"><a href="glm-2.html#parametric-modulation-with-cosine-regressor"><i class="fa fa-check"></i><b>5.1.1</b> Parametric modulation with cosine regressor</a></li>
<li class="chapter" data-level="5.1.2" data-path="glm-2.html"><a href="glm-2.html#set-up-the-glm-using-fsl-feat-1"><i class="fa fa-check"></i><b>5.1.2</b> Set up the GLM using FSL FEAT</a></li>
<li class="chapter" data-level="5.1.3" data-path="glm-2.html"><a href="glm-2.html#run-glm2"><i class="fa fa-check"></i><b>5.1.3</b> Run GLM2</a></li>
<li class="chapter" data-level="5.1.4" data-path="glm-2.html"><a href="glm-2.html#glm-2-results"><i class="fa fa-check"></i><b>5.1.4</b> GLM 2 results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="credit.html"><a href="credit.html"><i class="fa fa-check"></i><b>6</b> Credit</a>
<ul>
<li class="chapter" data-level="6.1" data-path="credit.html"><a href="credit.html#gridcat"><i class="fa fa-check"></i><b>6.1</b> GridCAT</a></li>
<li class="chapter" data-level="6.2" data-path="credit.html"><a href="credit.html#hosting-on-gitpages"><i class="fa fa-check"></i><b>6.2</b> Hosting on GitPages</a></li>
<li class="chapter" data-level="6.3" data-path="credit.html"><a href="credit.html#publishing-on-github-pages"><i class="fa fa-check"></i><b>6.3</b> Publishing on GitHub Pages</a></li>
<li class="chapter" data-level="6.4" data-path="credit.html"><a href="credit.html#list-of-r-packages"><i class="fa fa-check"></i><b>6.4</b> List of R packages</a></li>
<li class="chapter" data-level="6.5" data-path="credit.html"><a href="credit.html#references"><i class="fa fa-check"></i><b>6.5</b> References</a></li>
<li class="chapter" data-level="6.6" data-path="credit.html"><a href="credit.html#session-info"><i class="fa fa-check"></i><b>6.6</b> Session Info</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Detecting Hexadirectional Signals in the Human Brain using R and FSL</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="estimate-orientation" class="section level1" number="4">
<h1><span class="header-section-number">4</span> Estimate orientation</h1>
<p>Based on the parameter estimates for the sine and cosine regressor we will now estimate the orientation of the n-fold symmetric signal. This estimated orientation then forms the basis for GLM2, where we look for signal modulations as a function of angular difference to the estimated orientation.</p>
<p>Typically, the orientation is averaged across runs and voxels in a region of interest such as the entorhinal cortex. This is also the approach we will implement here for now. A possible long-term goal is to use the voxelwise orientation for GLM2 for whole-brain/whole-surface analysis. However, I need to better understand how to implement voxelwise regression before I can do this.</p>
<div id="load-pes-of-parametric-modulators" class="section level2" number="4.1">
<h2><span class="header-section-number">4.1</span> Load PEs of parametric modulators</h2>
<p>We begin by building a dataframe holding the parameter estimates (PEs) of the sine and cosine regressor for each subject, run and periodicity.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="estimate-orientation.html#cb26-1" aria-hidden="true" tabindex="-1"></a>pmod_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb26-2"><a href="estimate-orientation.html#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="estimate-orientation.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_sub <span class="cf">in</span> subjects){</span>
<span id="cb26-4"><a href="estimate-orientation.html#cb26-4" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-5"><a href="estimate-orientation.html#cb26-5" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load the right EC mask and linearize it</span></span>
<span id="cb26-6"><a href="estimate-orientation.html#cb26-6" aria-hidden="true" tabindex="-1"></a>  ec_mask_nii <span class="ot">&lt;-</span> <span class="fu">readNIfTI2</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;ROI_masks&quot;</span>,</span>
<span id="cb26-7"><a href="estimate-orientation.html#cb26-7" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">&quot;ROImask_entorhinalCortex_RH.nii&quot;</span>))</span>
<span id="cb26-8"><a href="estimate-orientation.html#cb26-8" aria-hidden="true" tabindex="-1"></a>  ec_mask_lin <span class="ot">&lt;-</span> <span class="fu">c</span>(ec_mask_nii)</span>
<span id="cb26-9"><a href="estimate-orientation.html#cb26-9" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-10"><a href="estimate-orientation.html#cb26-10" aria-hidden="true" tabindex="-1"></a>  <span class="co"># load the combined brain mask and linearize it</span></span>
<span id="cb26-11"><a href="estimate-orientation.html#cb26-11" aria-hidden="true" tabindex="-1"></a>  brain_mask_nii <span class="ot">&lt;-</span> <span class="fu">readNIfTI2</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;brain_mask&quot;</span>, i_sub,</span>
<span id="cb26-12"><a href="estimate-orientation.html#cb26-12" aria-hidden="true" tabindex="-1"></a>                                    <span class="st">&quot;comb_brain_mask_tMean100.nii.gz&quot;</span>))</span>
<span id="cb26-13"><a href="estimate-orientation.html#cb26-13" aria-hidden="true" tabindex="-1"></a>  brain_mask_lin <span class="ot">&lt;-</span> <span class="fu">as.logical</span>(<span class="fu">c</span>(brain_mask_nii))</span>
<span id="cb26-14"><a href="estimate-orientation.html#cb26-14" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb26-15"><a href="estimate-orientation.html#cb26-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_run <span class="cf">in</span> runs){ </span>
<span id="cb26-16"><a href="estimate-orientation.html#cb26-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (i_period <span class="cf">in</span> periodicities){</span>
<span id="cb26-17"><a href="estimate-orientation.html#cb26-17" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-18"><a href="estimate-orientation.html#cb26-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># load  the sine and cosine parameter estimates</span></span>
<span id="cb26-19"><a href="estimate-orientation.html#cb26-19" aria-hidden="true" tabindex="-1"></a>      <span class="co"># sine and cosine regressors were the second/third regressors and are thus the</span></span>
<span id="cb26-20"><a href="estimate-orientation.html#cb26-20" aria-hidden="true" tabindex="-1"></a>      <span class="co"># third and fifth PEs in the output because of the temporal derivatives</span></span>
<span id="cb26-21"><a href="estimate-orientation.html#cb26-21" aria-hidden="true" tabindex="-1"></a>      sin_fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;glm1&quot;</span>, <span class="st">&quot;glm1_firsthalf&quot;</span>, <span class="fu">paste0</span>(i_period, <span class="st">&quot;fold&quot;</span>), </span>
<span id="cb26-22"><a href="estimate-orientation.html#cb26-22" aria-hidden="true" tabindex="-1"></a>                     i_sub, i_run, <span class="st">&quot;pe3.nii.gz&quot;</span>)</span>
<span id="cb26-23"><a href="estimate-orientation.html#cb26-23" aria-hidden="true" tabindex="-1"></a>      cos_fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;glm1&quot;</span>, <span class="st">&quot;glm1_firsthalf&quot;</span>, <span class="fu">paste0</span>(i_period, <span class="st">&quot;fold&quot;</span>), </span>
<span id="cb26-24"><a href="estimate-orientation.html#cb26-24" aria-hidden="true" tabindex="-1"></a>                     i_sub, i_run, <span class="st">&quot;pe5.nii.gz&quot;</span>)</span>
<span id="cb26-25"><a href="estimate-orientation.html#cb26-25" aria-hidden="true" tabindex="-1"></a>      sin_nii <span class="ot">&lt;-</span> <span class="fu">readNIfTI2</span>(sin_fn)</span>
<span id="cb26-26"><a href="estimate-orientation.html#cb26-26" aria-hidden="true" tabindex="-1"></a>      cos_nii <span class="ot">&lt;-</span> <span class="fu">readNIfTI2</span>(cos_fn)</span>
<span id="cb26-27"><a href="estimate-orientation.html#cb26-27" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb26-28"><a href="estimate-orientation.html#cb26-28" aria-hidden="true" tabindex="-1"></a>      curr_df <span class="ot">&lt;-</span> <span class="fu">tibble</span>(<span class="at">subID =</span> i_sub, <span class="at">run =</span> i_run, <span class="at">periodicity =</span> i_period,</span>
<span id="cb26-29"><a href="estimate-orientation.html#cb26-29" aria-hidden="true" tabindex="-1"></a>                        <span class="at">sin =</span> <span class="fu">c</span>(sin_nii)[brain_mask_lin],</span>
<span id="cb26-30"><a href="estimate-orientation.html#cb26-30" aria-hidden="true" tabindex="-1"></a>                        <span class="at">cos =</span> <span class="fu">c</span>(cos_nii)[brain_mask_lin],</span>
<span id="cb26-31"><a href="estimate-orientation.html#cb26-31" aria-hidden="true" tabindex="-1"></a>                        <span class="at">ec =</span> <span class="fu">as.logical</span>(ec_mask_lin[brain_mask_lin]),</span>
<span id="cb26-32"><a href="estimate-orientation.html#cb26-32" aria-hidden="true" tabindex="-1"></a>                        <span class="at">vox_num =</span> <span class="fu">which</span>(brain_mask_lin<span class="sc">==</span><span class="dv">1</span>)) </span>
<span id="cb26-33"><a href="estimate-orientation.html#cb26-33" aria-hidden="true" tabindex="-1"></a>      pmod_df <span class="ot">&lt;-</span> <span class="fu">rbind</span>(pmod_df, curr_df)</span>
<span id="cb26-34"><a href="estimate-orientation.html#cb26-34" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb26-35"><a href="estimate-orientation.html#cb26-35" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb26-36"><a href="estimate-orientation.html#cb26-36" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="compute-voxelwise-orientation" class="section level2" number="4.2">
<h2><span class="header-section-number">4.2</span> Compute Voxelwise Orientation</h2>
<p>We can now compute the orientation for each voxel and periodicity. The resulting dataframe has orientation values in radians and in degrees. Note that these are in a range from 2*pi/periodicity and 360/periodicity, respectively.</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="estimate-orientation.html#cb27-1" aria-hidden="true" tabindex="-1"></a>orient_allvox <span class="ot">&lt;-</span> pmod_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb27-2"><a href="estimate-orientation.html#cb27-2" aria-hidden="true" tabindex="-1"></a>  <span class="at">orient_rad =</span> <span class="fu">atan2</span>(sin, cos), <span class="co"># estimate orientation in radians (range -pi to pi)</span></span>
<span id="cb27-3"><a href="estimate-orientation.html#cb27-3" aria-hidden="true" tabindex="-1"></a>  <span class="at">orient_rad =</span> <span class="fu">ifelse</span>(orient_rad<span class="sc">&lt;</span><span class="dv">0</span>, orient_rad<span class="sc">+</span>(<span class="dv">2</span><span class="sc">*</span>pi), orient_rad), <span class="co"># bring to range 0 to 2*pi</span></span>
<span id="cb27-4"><a href="estimate-orientation.html#cb27-4" aria-hidden="true" tabindex="-1"></a>  <span class="at">orient_rad =</span> orient_rad<span class="sc">/</span>periodicity, <span class="co"># divide by periodicity because of n-fold symmetry</span></span>
<span id="cb27-5"><a href="estimate-orientation.html#cb27-5" aria-hidden="true" tabindex="-1"></a>  <span class="at">orient_deg =</span> orient_rad <span class="sc">*</span> <span class="dv">180</span><span class="sc">/</span>pi, <span class="co"># convert to degrees</span></span>
<span id="cb27-6"><a href="estimate-orientation.html#cb27-6" aria-hidden="true" tabindex="-1"></a>  <span class="at">amplitude =</span> <span class="fu">sqrt</span>((<span class="fu">c</span>(cos)<span class="sc">*</span><span class="fu">c</span>(cos)) <span class="sc">+</span> (<span class="fu">c</span>(sin)<span class="sc">*</span><span class="fu">c</span>(sin))) <span class="co"># calculate amplitude for later voxel weighting</span></span>
<span id="cb27-7"><a href="estimate-orientation.html#cb27-7" aria-hidden="true" tabindex="-1"></a>  )</span>
<span id="cb27-8"><a href="estimate-orientation.html#cb27-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-9"><a href="estimate-orientation.html#cb27-9" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(orient_allvox)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 10
##   subID run   periodicity   sin   cos ec    vox_num orient_rad orient_deg amplitude
##   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt; &lt;dbl&gt; &lt;dbl&gt; &lt;lgl&gt;   &lt;int&gt;      &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1 sub01 run01           6 6.53  -2.83 FALSE    4802      0.330       18.9      7.12
## 2 sub01 run01           6 5.82  -2.89 FALSE    4803      0.339       19.4      6.50
## 3 sub01 run01           6 3.62  -2.45 FALSE    4804      0.361       20.7      4.37
## 4 sub01 run01           6 1.73  -1.73 FALSE    4805      0.393       22.5      2.45
## 5 sub01 run01           6 0.808 -1.25 FALSE    4807      0.428       24.5      1.49
## 6 sub01 run01           6 1.42  -1.16 FALSE    4808      0.376       21.5      1.83</code></pre>
<p>Because we have multiple runs, we might want to estimate a voxel’s orientation based on average across runs of the sine and cosine parameter estimates.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="estimate-orientation.html#cb29-1" aria-hidden="true" tabindex="-1"></a>ori_df_avg <span class="ot">&lt;-</span> orient_allvox <span class="sc">%&gt;%</span></span>
<span id="cb29-2"><a href="estimate-orientation.html#cb29-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subID, periodicity, vox_num) <span class="sc">%&gt;%</span></span>
<span id="cb29-3"><a href="estimate-orientation.html#cb29-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">summarize</span>(<span class="at">sin =</span> <span class="fu">mean</span>(sin),</span>
<span id="cb29-4"><a href="estimate-orientation.html#cb29-4" aria-hidden="true" tabindex="-1"></a>            <span class="at">cos =</span> <span class="fu">mean</span>(cos),</span>
<span id="cb29-5"><a href="estimate-orientation.html#cb29-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">ec =</span> <span class="fu">unique</span>(ec), <span class="at">.groups =</span> <span class="st">&quot;drop&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-6"><a href="estimate-orientation.html#cb29-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">add_column</span>(<span class="at">run =</span> <span class="st">&quot;average&quot;</span>, <span class="at">.after =</span> <span class="st">&quot;subID&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb29-7"><a href="estimate-orientation.html#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(</span>
<span id="cb29-8"><a href="estimate-orientation.html#cb29-8" aria-hidden="true" tabindex="-1"></a>    <span class="at">orient_rad =</span> <span class="fu">atan2</span>(sin, cos), <span class="co"># estimate orientation in radians (range -pi to pi)</span></span>
<span id="cb29-9"><a href="estimate-orientation.html#cb29-9" aria-hidden="true" tabindex="-1"></a>    <span class="at">orient_rad =</span> <span class="fu">ifelse</span>(orient_rad<span class="sc">&lt;</span><span class="dv">0</span>, orient_rad<span class="sc">+</span>(<span class="dv">2</span><span class="sc">*</span>pi), orient_rad), <span class="co"># bring to range 0 to 2*pi</span></span>
<span id="cb29-10"><a href="estimate-orientation.html#cb29-10" aria-hidden="true" tabindex="-1"></a>    <span class="at">orient_rad =</span> orient_rad<span class="sc">/</span>periodicity, <span class="co"># divide by periodicity because of n-fold symmetry</span></span>
<span id="cb29-11"><a href="estimate-orientation.html#cb29-11" aria-hidden="true" tabindex="-1"></a>    <span class="at">orient_deg =</span> orient_rad <span class="sc">*</span> <span class="dv">180</span><span class="sc">/</span>pi, <span class="co"># convert to degrees</span></span>
<span id="cb29-12"><a href="estimate-orientation.html#cb29-12" aria-hidden="true" tabindex="-1"></a>    <span class="at">amplitude =</span> <span class="fu">sqrt</span>((<span class="fu">c</span>(cos)<span class="sc">*</span><span class="fu">c</span>(cos)) <span class="sc">+</span> (<span class="fu">c</span>(sin)<span class="sc">*</span><span class="fu">c</span>(sin)))) <span class="co"># calculate amplitude for later voxel weighting</span></span>
<span id="cb29-13"><a href="estimate-orientation.html#cb29-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-14"><a href="estimate-orientation.html#cb29-14" aria-hidden="true" tabindex="-1"></a>orient_allvox <span class="ot">&lt;-</span> <span class="fu">rbind</span>(orient_allvox, ori_df_avg)</span></code></pre></div>
</div>
<div id="average-grid-orientations" class="section level2" number="4.3">
<h2><span class="header-section-number">4.3</span> Average grid orientations</h2>
<p>To average the estimated orientations across voxels, let’s define a custom function. This is similar to the function in the GridCAT toolbox. It is written to be used with pipes, but probably this could be done more elegantly.</p>
<p>Usage:</p>
<ul>
<li>in_df is the input data frame with one row per voxel</li>
<li>ori_values is the name of the column holding the voxelwise orientations</li>
<li>x-fold is the periodicity of the signal you are looking at</li>
<li>weighted is an option for an amplitude-weighted average of the orientation. If you want no weighted average, set it to FALSE</li>
<li>in_deg is a logical for whether the orientation value columns is in degrees (TRUE) or radians (FALSE)</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="estimate-orientation.html#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># custom function to average grid orientation across voxels, for usage see text above</span></span>
<span id="cb30-2"><a href="estimate-orientation.html#cb30-2" aria-hidden="true" tabindex="-1"></a>calc_avg_ori <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">in_df =</span> <span class="cn">NULL</span>, <span class="at">ori_values =</span> <span class="cn">NULL</span>, <span class="at">x_fold =</span> <span class="st">&quot;periodicity&quot;</span>, <span class="at">weighted =</span> <span class="cn">FALSE</span>, <span class="at">in_deg =</span> <span class="cn">TRUE</span>){</span>
<span id="cb30-3"><a href="estimate-orientation.html#cb30-3" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-4"><a href="estimate-orientation.html#cb30-4" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Input checking (pull variables from dataframe etc., could probably be more elegant)</span></span>
<span id="cb30-5"><a href="estimate-orientation.html#cb30-5" aria-hidden="true" tabindex="-1"></a>  ori_values <span class="ot">&lt;-</span> in_df <span class="sc">%&gt;%</span> <span class="fu">pull</span>(ori_values) <span class="co"># returns numeric vector of orientations</span></span>
<span id="cb30-6"><a href="estimate-orientation.html#cb30-6" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-7"><a href="estimate-orientation.html#cb30-7" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(<span class="sc">!</span><span class="fu">is.numeric</span>(x_fold)){ <span class="co"># make sure x_fold is one integer</span></span>
<span id="cb30-8"><a href="estimate-orientation.html#cb30-8" aria-hidden="true" tabindex="-1"></a>    x_fold <span class="ot">&lt;-</span> in_df <span class="sc">%&gt;%</span> <span class="fu">pull</span>(x_fold) <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="co"># if it&#39;s a column, find the unique values</span></span>
<span id="cb30-9"><a href="estimate-orientation.html#cb30-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span>(<span class="sc">!</span><span class="fu">length</span>(x_fold <span class="sc">==</span> <span class="dv">1</span>)){ <span class="co"># break if there is not one unique value</span></span>
<span id="cb30-10"><a href="estimate-orientation.html#cb30-10" aria-hidden="true" tabindex="-1"></a>      <span class="fu">stop</span>(<span class="fu">sprintf</span>((<span class="st">&quot;Can&#39;t average over multiple periodicities! Length of x_fold is %d&quot;</span>),</span>
<span id="cb30-11"><a href="estimate-orientation.html#cb30-11" aria-hidden="true" tabindex="-1"></a>                   <span class="fu">length</span>(x_fold)))}</span>
<span id="cb30-12"><a href="estimate-orientation.html#cb30-12" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-13"><a href="estimate-orientation.html#cb30-13" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(weighted <span class="sc">==</span> <span class="cn">FALSE</span>){weighted <span class="ot">&lt;-</span> <span class="dv">1</span>}  <span class="co"># if no weighting is desired, all weights = 1</span></span>
<span id="cb30-14"><a href="estimate-orientation.html#cb30-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>{weighted <span class="ot">&lt;-</span> in_df <span class="sc">%&gt;%</span> <span class="fu">pull</span>(weighted)} <span class="co"># else get numeric vector of weights</span></span>
<span id="cb30-15"><a href="estimate-orientation.html#cb30-15" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-16"><a href="estimate-orientation.html#cb30-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transform voxelwise orientations from range [0 360/xFoldSymmetry] to [0 360] degrees or [0 2*pi]  radians,</span></span>
<span id="cb30-17"><a href="estimate-orientation.html#cb30-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># in order to enable calculation of subsequent trigonometric functions which expect this range.</span></span>
<span id="cb30-18"><a href="estimate-orientation.html#cb30-18" aria-hidden="true" tabindex="-1"></a>  ori_values360 <span class="ot">&lt;-</span> ori_values <span class="sc">*</span> x_fold</span>
<span id="cb30-19"><a href="estimate-orientation.html#cb30-19" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-20"><a href="estimate-orientation.html#cb30-20" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transformation from polar to cartesian cordinate system (for weighting)</span></span>
<span id="cb30-21"><a href="estimate-orientation.html#cb30-21" aria-hidden="true" tabindex="-1"></a>  cart_df <span class="ot">&lt;-</span> useful<span class="sc">::</span><span class="fu">pol2cart</span>(<span class="at">r =</span> weighted, <span class="at">theta =</span> ori_values360, <span class="at">degrees =</span> in_deg)</span>
<span id="cb30-22"><a href="estimate-orientation.html#cb30-22" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-23"><a href="estimate-orientation.html#cb30-23" aria-hidden="true" tabindex="-1"></a>  <span class="co"># find the mean across X and across Y separately</span></span>
<span id="cb30-24"><a href="estimate-orientation.html#cb30-24" aria-hidden="true" tabindex="-1"></a>  x_mean <span class="ot">=</span> <span class="fu">mean</span>(cart_df<span class="sc">$</span>x)</span>
<span id="cb30-25"><a href="estimate-orientation.html#cb30-25" aria-hidden="true" tabindex="-1"></a>  y_mean <span class="ot">=</span> <span class="fu">mean</span>(cart_df<span class="sc">$</span>y)</span>
<span id="cb30-26"><a href="estimate-orientation.html#cb30-26" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-27"><a href="estimate-orientation.html#cb30-27" aria-hidden="true" tabindex="-1"></a>  <span class="co"># Transformation back from cartesian to polar cordinate system</span></span>
<span id="cb30-28"><a href="estimate-orientation.html#cb30-28" aria-hidden="true" tabindex="-1"></a>  out_df <span class="ot">&lt;-</span> <span class="fu">cart2pol</span>(<span class="at">x=</span>x_mean, <span class="at">y=</span>y_mean, <span class="at">degrees =</span> in_deg)</span>
<span id="cb30-29"><a href="estimate-orientation.html#cb30-29" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-30"><a href="estimate-orientation.html#cb30-30" aria-hidden="true" tabindex="-1"></a>  <span class="co"># touch up the output a bit</span></span>
<span id="cb30-31"><a href="estimate-orientation.html#cb30-31" aria-hidden="true" tabindex="-1"></a>  <span class="cf">if</span>(in_deg){</span>
<span id="cb30-32"><a href="estimate-orientation.html#cb30-32" aria-hidden="true" tabindex="-1"></a>    out_df <span class="ot">&lt;-</span> out_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb30-33"><a href="estimate-orientation.html#cb30-33" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_ori_deg =</span> theta<span class="sc">/</span>x_fold,</span>
<span id="cb30-34"><a href="estimate-orientation.html#cb30-34" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_ori_rad =</span> (theta<span class="sc">*</span>pi<span class="sc">/</span><span class="dv">180</span>)<span class="sc">/</span>x_fold)</span>
<span id="cb30-35"><a href="estimate-orientation.html#cb30-35" aria-hidden="true" tabindex="-1"></a>  } <span class="cf">else</span>{</span>
<span id="cb30-36"><a href="estimate-orientation.html#cb30-36" aria-hidden="true" tabindex="-1"></a>    out_df <span class="ot">&lt;-</span> out_df <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(</span>
<span id="cb30-37"><a href="estimate-orientation.html#cb30-37" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_ori_rad =</span> theta<span class="sc">/</span>x_fold,</span>
<span id="cb30-38"><a href="estimate-orientation.html#cb30-38" aria-hidden="true" tabindex="-1"></a>      <span class="at">avg_ori_deg =</span> (theta<span class="sc">*</span><span class="dv">180</span><span class="sc">/</span>pi)<span class="sc">/</span>x_fold)</span>
<span id="cb30-39"><a href="estimate-orientation.html#cb30-39" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb30-40"><a href="estimate-orientation.html#cb30-40" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb30-41"><a href="estimate-orientation.html#cb30-41" aria-hidden="true" tabindex="-1"></a>  <span class="co"># return the df after removing the angle in 360 deg space and the x and y coords </span></span>
<span id="cb30-42"><a href="estimate-orientation.html#cb30-42" aria-hidden="true" tabindex="-1"></a>  out_df <span class="ot">&lt;-</span> out_df <span class="sc">%&gt;%</span> <span class="fu">select</span>(<span class="sc">-</span>theta, <span class="sc">-</span>x, <span class="sc">-</span>y)</span>
<span id="cb30-43"><a href="estimate-orientation.html#cb30-43" aria-hidden="true" tabindex="-1"></a>  <span class="fu">return</span>(out_df)</span>
<span id="cb30-44"><a href="estimate-orientation.html#cb30-44" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<div id="wholebrain-average-orientation" class="section level3" number="4.3.1">
<h3><span class="header-section-number">4.3.1</span> Wholebrain average orientation</h3>
<p>Let’s first compute the average grid orientation across all voxels.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="estimate-orientation.html#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted average orientation across voxels for each participant, run and periodicity</span></span>
<span id="cb31-2"><a href="estimate-orientation.html#cb31-2" aria-hidden="true" tabindex="-1"></a>avg_orient_weighted <span class="ot">&lt;-</span> orient_allvox <span class="sc">%&gt;%</span> </span>
<span id="cb31-3"><a href="estimate-orientation.html#cb31-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subID, run, periodicity) <span class="sc">%&gt;%</span></span>
<span id="cb31-4"><a href="estimate-orientation.html#cb31-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(<span class="fu">calc_avg_ori</span>(<span class="at">in_df =</span> ., <span class="at">ori_values =</span> <span class="st">&quot;orient_deg&quot;</span>, </span>
<span id="cb31-5"><a href="estimate-orientation.html#cb31-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x_fold =</span> <span class="st">&quot;periodicity&quot;</span>, <span class="at">weighted =</span> <span class="st">&quot;amplitude&quot;</span>, <span class="at">in_deg =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-6"><a href="estimate-orientation.html#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-7"><a href="estimate-orientation.html#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted =</span> <span class="st">&quot;weighted&quot;</span>)</span>
<span id="cb31-8"><a href="estimate-orientation.html#cb31-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-9"><a href="estimate-orientation.html#cb31-9" aria-hidden="true" tabindex="-1"></a><span class="co"># unweighted average orientation across voxels for each participant, run and periodicity</span></span>
<span id="cb31-10"><a href="estimate-orientation.html#cb31-10" aria-hidden="true" tabindex="-1"></a>avg_orient_unweighted <span class="ot">&lt;-</span> orient_allvox <span class="sc">%&gt;%</span> </span>
<span id="cb31-11"><a href="estimate-orientation.html#cb31-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subID, run, periodicity) <span class="sc">%&gt;%</span></span>
<span id="cb31-12"><a href="estimate-orientation.html#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(<span class="fu">calc_avg_ori</span>(<span class="at">in_df =</span> ., <span class="at">ori_values =</span> <span class="st">&quot;orient_deg&quot;</span>, </span>
<span id="cb31-13"><a href="estimate-orientation.html#cb31-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x_fold =</span> <span class="st">&quot;periodicity&quot;</span>, <span class="at">weighted =</span> <span class="cn">FALSE</span>, <span class="at">in_deg =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb31-14"><a href="estimate-orientation.html#cb31-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb31-15"><a href="estimate-orientation.html#cb31-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted =</span> <span class="st">&quot;unweighted&quot;</span>)</span>
<span id="cb31-16"><a href="estimate-orientation.html#cb31-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-17"><a href="estimate-orientation.html#cb31-17" aria-hidden="true" tabindex="-1"></a><span class="co"># bind the two together</span></span>
<span id="cb31-18"><a href="estimate-orientation.html#cb31-18" aria-hidden="true" tabindex="-1"></a>avg_orient_allvox <span class="ot">&lt;-</span> <span class="fu">rbind</span>(avg_orient_weighted, avg_orient_unweighted)</span>
<span id="cb31-19"><a href="estimate-orientation.html#cb31-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(avg_orient_allvox)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##   subID run     periodicity     r avg_ori_deg avg_ori_rad weighted  
##   &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;     
## 1 sub01 average           6 0.285        28.8       0.502 weighted  
## 2 sub01 run01             6 0.214        26.6       0.464 weighted  
## 3 sub01 run02             6 0.364        30.1       0.525 weighted  
## 4 sub01 average           6 0.287        29.4       0.513 unweighted
## 5 sub01 run01             6 0.143        28.6       0.499 unweighted
## 6 sub01 run02             6 0.284        29.8       0.520 unweighted</code></pre>
<p>To get an overview of the estimated orientations, let’s plot them as a circular histogram for all brain voxels, together with the weighted and unweighted angular means.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="estimate-orientation.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many bins do we want for the polar histogram?</span></span>
<span id="cb33-2"><a href="estimate-orientation.html#cb33-2" aria-hidden="true" tabindex="-1"></a>n_bins <span class="ot">=</span> <span class="dv">60</span></span>
<span id="cb33-3"><a href="estimate-orientation.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="estimate-orientation.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add a variable with the maximum histogram count with the given number of bins</span></span>
<span id="cb33-5"><a href="estimate-orientation.html#cb33-5" aria-hidden="true" tabindex="-1"></a><span class="co"># this will be used later to determine the length of the arrow indicating the means</span></span>
<span id="cb33-6"><a href="estimate-orientation.html#cb33-6" aria-hidden="true" tabindex="-1"></a>avg_orient_allvox <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(avg_orient_allvox, orient_allvox <span class="sc">%&gt;%</span> </span>
<span id="cb33-7"><a href="estimate-orientation.html#cb33-7" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">group_by</span>(subID, run, periodicity) <span class="sc">%&gt;%</span></span>
<span id="cb33-8"><a href="estimate-orientation.html#cb33-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">summarise</span>(<span class="at">hcounts =</span>  <span class="fu">max</span>(<span class="fu">hist</span>(orient_deg, <span class="at">plot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb33-9"><a href="estimate-orientation.html#cb33-9" aria-hidden="true" tabindex="-1"></a>                                                                <span class="at">breaks =</span> n_bins)<span class="sc">$</span>counts),</span>
<span id="cb33-10"><a href="estimate-orientation.html#cb33-10" aria-hidden="true" tabindex="-1"></a>                                            <span class="at">.groups=</span><span class="st">&quot;drop&quot;</span>),</span>
<span id="cb33-11"><a href="estimate-orientation.html#cb33-11" aria-hidden="true" tabindex="-1"></a>                                <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;subID&quot;</span>, <span class="st">&quot;run&quot;</span>, <span class="st">&quot;periodicity&quot;</span>))</span>
<span id="cb33-12"><a href="estimate-orientation.html#cb33-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-13"><a href="estimate-orientation.html#cb33-13" aria-hidden="true" tabindex="-1"></a><span class="co"># make polar histogram across voxels and highlight (un)weighted mean orientations</span></span>
<span id="cb33-14"><a href="estimate-orientation.html#cb33-14" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(orient_allvox, <span class="fu">aes</span>(<span class="at">x=</span>orient_deg)) <span class="sc">+</span></span>
<span id="cb33-15"><a href="estimate-orientation.html#cb33-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>() <span class="sc">+</span></span>
<span id="cb33-16"><a href="estimate-orientation.html#cb33-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb33-17"><a href="estimate-orientation.html#cb33-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">bins =</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb33-18"><a href="estimate-orientation.html#cb33-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(subID <span class="sc">~</span> run) <span class="sc">+</span></span>
<span id="cb33-19"><a href="estimate-orientation.html#cb33-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Estimated grid orientations [wholebrain]&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-20"><a href="estimate-orientation.html#cb33-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>avg_orient_allvox, </span>
<span id="cb33-21"><a href="estimate-orientation.html#cb33-21" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x=</span>avg_ori_deg,<span class="at">xend=</span>avg_ori_deg, <span class="at">y=</span><span class="dv">0</span>, <span class="at">yend=</span>hcounts, </span>
<span id="cb33-22"><a href="estimate-orientation.html#cb33-22" aria-hidden="true" tabindex="-1"></a>                   <span class="at">group=</span>weighted, <span class="at">color=</span>weighted),</span>
<span id="cb33-23"><a href="estimate-orientation.html#cb33-23" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">angle=</span><span class="dv">10</span>,<span class="at">type=</span><span class="st">&quot;closed&quot;</span>,<span class="at">length=</span><span class="fu">unit</span>(<span class="fl">0.3</span>,<span class="st">&quot;cm&quot;</span>))) <span class="sc">+</span></span>
<span id="cb33-24"><a href="estimate-orientation.html#cb33-24" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;mean orientation&quot;</span>) <span class="sc">+</span></span>
<span id="cb33-25"><a href="estimate-orientation.html#cb33-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb33-26"><a href="estimate-orientation.html#cb33-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 row(s) containing missing values (geom_path).</code></pre>
<p><img src="Hexadirectioal-analysis-pipeline_files/figure-html/plot_orient_hist_brainvox-1.png" width="672" /></p>
</div>
<div id="entorhinal-cortex-average-orientation" class="section level3" number="4.3.2">
<h3><span class="header-section-number">4.3.2</span> Entorhinal Cortex average orientation</h3>
<p>Because our first steps here will focus on the right EC (to check results against the GridCAT tutorial), let’s look at the orientations in that ROI.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="estimate-orientation.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># let&#39;s look at the EC voxels only</span></span>
<span id="cb35-2"><a href="estimate-orientation.html#cb35-2" aria-hidden="true" tabindex="-1"></a>orient_ec <span class="ot">&lt;-</span> orient_allvox <span class="sc">%&gt;%</span> </span>
<span id="cb35-3"><a href="estimate-orientation.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(ec<span class="sc">==</span><span class="cn">TRUE</span>)</span>
<span id="cb35-4"><a href="estimate-orientation.html#cb35-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(orient_ec)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 10
##   subID run   periodicity     sin    cos ec    vox_num orient_rad orient_deg amplitude
##   &lt;chr&gt; &lt;chr&gt;       &lt;dbl&gt;   &lt;dbl&gt;  &lt;dbl&gt; &lt;lgl&gt;   &lt;int&gt;      &lt;dbl&gt;      &lt;dbl&gt;     &lt;dbl&gt;
## 1 sub01 run01           6 -0.0603 -0.448 TRUE    98647      0.546       31.3     0.453
## 2 sub01 run01           6  0.113  -0.628 TRUE    98755      0.494       28.3     0.638
## 3 sub01 run01           6  0.108  -0.440 TRUE    98756      0.483       27.7     0.453
## 4 sub01 run01           6  0.214  -0.748 TRUE    98971      0.477       27.3     0.778
## 5 sub01 run01           6  0.416  -0.841 TRUE    98972      0.447       25.6     0.938
## 6 sub01 run01           6  0.0366 -0.550 TRUE    99079      0.513       29.4     0.551</code></pre>
<p>We first compute the average grid orientation across all EC voxels.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="estimate-orientation.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># weighted average orientation across voxels for each participant, run and periodicity</span></span>
<span id="cb37-2"><a href="estimate-orientation.html#cb37-2" aria-hidden="true" tabindex="-1"></a>avg_orient_weighted <span class="ot">&lt;-</span> orient_ec <span class="sc">%&gt;%</span> </span>
<span id="cb37-3"><a href="estimate-orientation.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subID, run, periodicity) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="estimate-orientation.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(<span class="fu">calc_avg_ori</span>(<span class="at">in_df =</span> ., <span class="at">ori_values =</span> <span class="st">&quot;orient_deg&quot;</span>, </span>
<span id="cb37-5"><a href="estimate-orientation.html#cb37-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x_fold =</span> <span class="st">&quot;periodicity&quot;</span>, <span class="at">weighted =</span> <span class="st">&quot;amplitude&quot;</span>, <span class="at">in_deg =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="estimate-orientation.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-7"><a href="estimate-orientation.html#cb37-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted =</span> <span class="st">&quot;weighted&quot;</span>)</span>
<span id="cb37-8"><a href="estimate-orientation.html#cb37-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-9"><a href="estimate-orientation.html#cb37-9" aria-hidden="true" tabindex="-1"></a><span class="co"># unweighted average orientation across voxels for each participant, run and periodicity</span></span>
<span id="cb37-10"><a href="estimate-orientation.html#cb37-10" aria-hidden="true" tabindex="-1"></a>avg_orient_unweighted <span class="ot">&lt;-</span> orient_ec <span class="sc">%&gt;%</span> </span>
<span id="cb37-11"><a href="estimate-orientation.html#cb37-11" aria-hidden="true" tabindex="-1"></a>  <span class="fu">group_by</span>(subID, run, periodicity) <span class="sc">%&gt;%</span></span>
<span id="cb37-12"><a href="estimate-orientation.html#cb37-12" aria-hidden="true" tabindex="-1"></a>  <span class="fu">do</span>(<span class="fu">calc_avg_ori</span>(<span class="at">in_df =</span> ., <span class="at">ori_values =</span> <span class="st">&quot;orient_deg&quot;</span>, </span>
<span id="cb37-13"><a href="estimate-orientation.html#cb37-13" aria-hidden="true" tabindex="-1"></a>                  <span class="at">x_fold =</span> <span class="st">&quot;periodicity&quot;</span>, <span class="at">weighted =</span> <span class="cn">FALSE</span>, <span class="at">in_deg =</span> <span class="cn">TRUE</span>)) <span class="sc">%&gt;%</span></span>
<span id="cb37-14"><a href="estimate-orientation.html#cb37-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span></span>
<span id="cb37-15"><a href="estimate-orientation.html#cb37-15" aria-hidden="true" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">weighted =</span> <span class="st">&quot;unweighted&quot;</span>)</span>
<span id="cb37-16"><a href="estimate-orientation.html#cb37-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb37-17"><a href="estimate-orientation.html#cb37-17" aria-hidden="true" tabindex="-1"></a><span class="co"># bind the two together</span></span>
<span id="cb37-18"><a href="estimate-orientation.html#cb37-18" aria-hidden="true" tabindex="-1"></a>avg_orient_ec <span class="ot">&lt;-</span> <span class="fu">rbind</span>(avg_orient_weighted, avg_orient_unweighted)</span>
<span id="cb37-19"><a href="estimate-orientation.html#cb37-19" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(avg_orient_ec)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 7
##   subID run     periodicity     r avg_ori_deg avg_ori_rad weighted  
##   &lt;chr&gt; &lt;chr&gt;         &lt;dbl&gt; &lt;dbl&gt;       &lt;dbl&gt;       &lt;dbl&gt; &lt;chr&gt;     
## 1 sub01 average           6 0.220        29.3       0.512 weighted  
## 2 sub01 run01             6 0.331        25.3       0.442 weighted  
## 3 sub01 run02             6 0.193        36.7       0.641 weighted  
## 4 sub01 average           6 0.348        30.6       0.535 unweighted
## 5 sub01 run01             6 0.363        28.0       0.488 unweighted
## 6 sub01 run02             6 0.291        36.2       0.632 unweighted</code></pre>
<p>To get an overview of the estimated orientations, let’s plot them as a circular histogram for all entorhinal cortex voxels, together with the weighted and unweighted angular means.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="estimate-orientation.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="co"># how many bins do we want for the polar histogram?</span></span>
<span id="cb39-2"><a href="estimate-orientation.html#cb39-2" aria-hidden="true" tabindex="-1"></a>n_bins <span class="ot">=</span> <span class="dv">60</span></span>
<span id="cb39-3"><a href="estimate-orientation.html#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="estimate-orientation.html#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="co"># add a variable with the maximum histogram count with the given number of bins</span></span>
<span id="cb39-5"><a href="estimate-orientation.html#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="co"># this will be used later to determine the length of the arrow indicating the means</span></span>
<span id="cb39-6"><a href="estimate-orientation.html#cb39-6" aria-hidden="true" tabindex="-1"></a>avg_orient_ec <span class="ot">&lt;-</span> <span class="fu">inner_join</span>(avg_orient_ec, </span>
<span id="cb39-7"><a href="estimate-orientation.html#cb39-7" aria-hidden="true" tabindex="-1"></a>                            orient_ec <span class="sc">%&gt;%</span> </span>
<span id="cb39-8"><a href="estimate-orientation.html#cb39-8" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">group_by</span>(subID, run, periodicity)  <span class="sc">%&gt;%</span></span>
<span id="cb39-9"><a href="estimate-orientation.html#cb39-9" aria-hidden="true" tabindex="-1"></a>                              <span class="fu">summarise</span>(<span class="at">hcounts =</span>  <span class="fu">max</span>(<span class="fu">hist</span>(orient_deg, <span class="at">plot =</span> <span class="cn">FALSE</span>,</span>
<span id="cb39-10"><a href="estimate-orientation.html#cb39-10" aria-hidden="true" tabindex="-1"></a>                                                            <span class="at">breaks =</span> n_bins)<span class="sc">$</span>counts),</span>
<span id="cb39-11"><a href="estimate-orientation.html#cb39-11" aria-hidden="true" tabindex="-1"></a>                                        <span class="at">.groups=</span><span class="st">&quot;drop&quot;</span>),</span>
<span id="cb39-12"><a href="estimate-orientation.html#cb39-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">by =</span> <span class="fu">c</span>(<span class="st">&quot;subID&quot;</span>, <span class="st">&quot;run&quot;</span>, <span class="st">&quot;periodicity&quot;</span>))</span>
<span id="cb39-13"><a href="estimate-orientation.html#cb39-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-14"><a href="estimate-orientation.html#cb39-14" aria-hidden="true" tabindex="-1"></a><span class="co"># make polar histogram across voxels and highlight (un)weighted mean orientations</span></span>
<span id="cb39-15"><a href="estimate-orientation.html#cb39-15" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(orient_ec, <span class="fu">aes</span>(<span class="at">x=</span>orient_deg)) <span class="sc">+</span></span>
<span id="cb39-16"><a href="estimate-orientation.html#cb39-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>() <span class="sc">+</span></span>
<span id="cb39-17"><a href="estimate-orientation.html#cb39-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">60</span>)) <span class="sc">+</span></span>
<span id="cb39-18"><a href="estimate-orientation.html#cb39-18" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">bins =</span> <span class="dv">60</span>) <span class="sc">+</span></span>
<span id="cb39-19"><a href="estimate-orientation.html#cb39-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(subID <span class="sc">~</span> run) <span class="sc">+</span></span>
<span id="cb39-20"><a href="estimate-orientation.html#cb39-20" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Estimated grid orientations [entorhinal cortex]&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-21"><a href="estimate-orientation.html#cb39-21" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_segment</span>(<span class="at">data=</span>avg_orient_ec,</span>
<span id="cb39-22"><a href="estimate-orientation.html#cb39-22" aria-hidden="true" tabindex="-1"></a>               <span class="fu">aes</span>(<span class="at">x=</span>avg_ori_deg,<span class="at">xend=</span>avg_ori_deg, <span class="at">y=</span><span class="dv">0</span>, <span class="at">yend=</span>hcounts, </span>
<span id="cb39-23"><a href="estimate-orientation.html#cb39-23" aria-hidden="true" tabindex="-1"></a>                  <span class="at">group=</span>weighted, <span class="at">color=</span>weighted),</span>
<span id="cb39-24"><a href="estimate-orientation.html#cb39-24" aria-hidden="true" tabindex="-1"></a>               <span class="at">arrow=</span><span class="fu">arrow</span>(<span class="at">angle=</span><span class="dv">10</span>,<span class="at">type=</span><span class="st">&quot;closed&quot;</span>,<span class="at">length=</span><span class="fu">unit</span>(<span class="fl">0.3</span>,<span class="st">&quot;cm&quot;</span>))) <span class="sc">+</span></span>
<span id="cb39-25"><a href="estimate-orientation.html#cb39-25" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">color =</span> <span class="st">&quot;mean orientation&quot;</span>) <span class="sc">+</span></span>
<span id="cb39-26"><a href="estimate-orientation.html#cb39-26" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>() <span class="sc">+</span></span>
<span id="cb39-27"><a href="estimate-orientation.html#cb39-27" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">legend.position =</span> <span class="st">&quot;bottom&quot;</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 2 row(s) containing missing values (geom_path).</code></pre>
<p><img src="Hexadirectioal-analysis-pipeline_files/figure-html/plot_orient_hist_ecvox-1.png" width="672" /></p>
</div>
</div>
<div id="brain-plot-of-estimated-orientations" class="section level2" number="4.4">
<h2><span class="header-section-number">4.4</span> Brain plot of estimated orientations</h2>
<p>The computations above have been done for each voxel in the entire brain. To see how estimated orientations are distributed throughout the brain, let’s plot the orientation for each voxel. As our brain mask is not very precise, this is not a very good plot, but serves as a proof-of-principle.</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="estimate-orientation.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize a nifti object for the orientation values </span></span>
<span id="cb41-2"><a href="estimate-orientation.html#cb41-2" aria-hidden="true" tabindex="-1"></a>orient_nii <span class="ot">&lt;-</span> brain_mask_nii</span>
<span id="cb41-3"><a href="estimate-orientation.html#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="estimate-orientation.html#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="co"># for the voxels in the brain mask, set the values to the orientation values based on the average across run</span></span>
<span id="cb41-5"><a href="estimate-orientation.html#cb41-5" aria-hidden="true" tabindex="-1"></a>orient_nii[brain_mask_nii<span class="sc">==</span><span class="dv">1</span>] <span class="ot">&lt;-</span> orient_allvox <span class="sc">%&gt;%</span> </span>
<span id="cb41-6"><a href="estimate-orientation.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(run<span class="sc">==</span><span class="st">&quot;average&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb41-7"><a href="estimate-orientation.html#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">pull</span>(orient_deg)</span>
<span id="cb41-8"><a href="estimate-orientation.html#cb41-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-9"><a href="estimate-orientation.html#cb41-9" aria-hidden="true" tabindex="-1"></a><span class="co"># overlay of estimated orientation</span></span>
<span id="cb41-10"><a href="estimate-orientation.html#cb41-10" aria-hidden="true" tabindex="-1"></a><span class="fu">ortho2</span>(brain_mask_nii, orient_nii, <span class="at">xyz =</span> <span class="fu">c</span>(<span class="dv">46</span>,<span class="dv">46</span>,<span class="dv">15</span>),</span>
<span id="cb41-11"><a href="estimate-orientation.html#cb41-11" aria-hidden="true" tabindex="-1"></a>       <span class="at">ycolorbar =</span> <span class="cn">TRUE</span>,</span>
<span id="cb41-12"><a href="estimate-orientation.html#cb41-12" aria-hidden="true" tabindex="-1"></a>       <span class="at">col.y =</span> oro.nifti<span class="sc">::</span><span class="fu">hotmetal</span>(<span class="dv">60</span>), </span>
<span id="cb41-13"><a href="estimate-orientation.html#cb41-13" aria-hidden="true" tabindex="-1"></a>       <span class="at">ybreaks =</span> <span class="fu">seq</span>(<span class="dv">0</span>,<span class="dv">60</span>,<span class="dv">1</span>))</span></code></pre></div>
<p><img src="Hexadirectioal-analysis-pipeline_files/figure-html/brainplot_orients-1.png" width="672" /></p>
</div>
<div id="store-estimated-grid-orientation" class="section level2" number="4.5">
<h2><span class="header-section-number">4.5</span> Store estimated grid orientation</h2>
<p>Calculating GLM 2 requires one reference grid orientation. This could be one separate one per run, but for now, let’s go with the orientation resulting from the average across runs. We pick the amplitude-weighte values.</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="estimate-orientation.html#cb42-1" aria-hidden="true" tabindex="-1"></a>fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;glm1&quot;</span>, <span class="st">&quot;glm1_firsthalf&quot;</span>, <span class="st">&quot;avg_orient_ec.txt&quot;</span>)</span>
<span id="cb42-2"><a href="estimate-orientation.html#cb42-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-3"><a href="estimate-orientation.html#cb42-3" aria-hidden="true" tabindex="-1"></a>avg_orient_ec <span class="sc">%&gt;%</span> </span>
<span id="cb42-4"><a href="estimate-orientation.html#cb42-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">filter</span>(run<span class="sc">==</span><span class="st">&quot;average&quot;</span>, weighted <span class="sc">==</span> <span class="st">&quot;weighted&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb42-5"><a href="estimate-orientation.html#cb42-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">select</span>(<span class="sc">-</span>hcounts) <span class="sc">%&gt;%</span></span>
<span id="cb42-6"><a href="estimate-orientation.html#cb42-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">write_delim</span>(<span class="at">file =</span> fn, <span class="at">delim =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span></code></pre></div>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="glm-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="glm-2.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
