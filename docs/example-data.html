<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Example Data | Detecting Hexadirectional Signals in the Human Brain using R and FSL</title>
  <meta name="description" content="2 Example Data | Detecting Hexadirectional Signals in the Human Brain using R and FSL" />
  <meta name="generator" content="bookdown 0.24 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Example Data | Detecting Hexadirectional Signals in the Human Brain using R and FSL" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Example Data | Detecting Hexadirectional Signals in the Human Brain using R and FSL" />
  
  
  

<meta name="author" content="Jacob Bellmund" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="glm-1.html"/>
<script src="libs/header-attrs-2.11/header-attrs.js"></script>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.0.1/anchor-sections.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.0.1/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements"><i class="fa fa-check"></i><b>1.1</b> Requirements</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#workflow"><i class="fa fa-check"></i><b>1.2</b> Workflow</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#cbs-imac-or-macbook"><i class="fa fa-check"></i><b>1.2.1</b> CBS iMac or Macbook</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#remote-linux"><i class="fa fa-check"></i><b>1.2.2</b> Remote Linux</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#running-the-analysis"><i class="fa fa-check"></i><b>1.2.3</b> Running the analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#required-packages"><i class="fa fa-check"></i><b>1.3</b> Required packages</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="example-data.html"><a href="example-data.html"><i class="fa fa-check"></i><b>2</b> Example Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="example-data.html"><a href="example-data.html#download-example-data"><i class="fa fa-check"></i><b>2.1</b> Download Example Data</a></li>
<li class="chapter" data-level="2.2" data-path="example-data.html"><a href="example-data.html#rearrange-data"><i class="fa fa-check"></i><b>2.2</b> Rearrange data</a></li>
<li class="chapter" data-level="2.3" data-path="example-data.html"><a href="example-data.html#event-tables"><i class="fa fa-check"></i><b>2.3</b> Event Tables</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="example-data.html"><a href="example-data.html#trajectory-duration"><i class="fa fa-check"></i><b>2.3.1</b> Trajectory duration</a></li>
<li class="chapter" data-level="2.3.2" data-path="example-data.html"><a href="example-data.html#angular-sampling"><i class="fa fa-check"></i><b>2.3.2</b> Angular Sampling</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="example-data.html"><a href="example-data.html#fmri"><i class="fa fa-check"></i><b>2.4</b> fMRI</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="example-data.html"><a href="example-data.html#merge-images-of-each-run"><i class="fa fa-check"></i><b>2.4.1</b> Merge images of each run</a></li>
<li class="chapter" data-level="2.4.2" data-path="example-data.html"><a href="example-data.html#calculate-tsnr"><i class="fa fa-check"></i><b>2.4.2</b> Calculate tSNR</a></li>
<li class="chapter" data-level="2.4.3" data-path="example-data.html"><a href="example-data.html#create-quick-brain-mask"><i class="fa fa-check"></i><b>2.4.3</b> Create quick brain mask</a></li>
<li class="chapter" data-level="2.4.4" data-path="example-data.html"><a href="example-data.html#mask-4d-functionals"><i class="fa fa-check"></i><b>2.4.4</b> Mask 4D functionals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="glm-1.html"><a href="glm-1.html"><i class="fa fa-check"></i><b>3</b> GLM 1</a>
<ul>
<li class="chapter" data-level="3.1" data-path="glm-1.html"><a href="glm-1.html#first-half-of-each-run"><i class="fa fa-check"></i><b>3.1</b> First half of each run</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="glm-1.html"><a href="glm-1.html#ev-files-for-feat"><i class="fa fa-check"></i><b>3.1.1</b> EV files for FEAT</a></li>
<li class="chapter" data-level="3.1.2" data-path="glm-1.html"><a href="glm-1.html#set-up-the-glm-using-fsl-feat"><i class="fa fa-check"></i><b>3.1.2</b> Set up the GLM using FSL FEAT</a></li>
<li class="chapter" data-level="3.1.3" data-path="glm-1.html"><a href="glm-1.html#run-glm1"><i class="fa fa-check"></i><b>3.1.3</b> Run GLM1</a></li>
<li class="chapter" data-level="3.1.4" data-path="glm-1.html"><a href="glm-1.html#results-glm-1"><i class="fa fa-check"></i><b>3.1.4</b> Results GLM 1</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="estimate-orientation.html"><a href="estimate-orientation.html"><i class="fa fa-check"></i><b>4</b> Estimate orientation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="estimate-orientation.html"><a href="estimate-orientation.html#load-pes-of-parametric-modulators"><i class="fa fa-check"></i><b>4.1</b> Load PEs of parametric modulators</a></li>
<li class="chapter" data-level="4.2" data-path="estimate-orientation.html"><a href="estimate-orientation.html#compute-voxelwise-orientation"><i class="fa fa-check"></i><b>4.2</b> Compute Voxelwise Orientation</a></li>
<li class="chapter" data-level="4.3" data-path="estimate-orientation.html"><a href="estimate-orientation.html#average-grid-orientations"><i class="fa fa-check"></i><b>4.3</b> Average grid orientations</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="estimate-orientation.html"><a href="estimate-orientation.html#wholebrain-average-orientation"><i class="fa fa-check"></i><b>4.3.1</b> Wholebrain average orientation</a></li>
<li class="chapter" data-level="4.3.2" data-path="estimate-orientation.html"><a href="estimate-orientation.html#entorhinal-cortex-average-orientation"><i class="fa fa-check"></i><b>4.3.2</b> Entorhinal Cortex average orientation</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="estimate-orientation.html"><a href="estimate-orientation.html#brain-plot-of-estimated-orientations"><i class="fa fa-check"></i><b>4.4</b> Brain plot of estimated orientations</a></li>
<li class="chapter" data-level="4.5" data-path="estimate-orientation.html"><a href="estimate-orientation.html#store-estimated-grid-orientation"><i class="fa fa-check"></i><b>4.5</b> Store estimated grid orientation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="glm-2.html"><a href="glm-2.html"><i class="fa fa-check"></i><b>5</b> GLM 2</a>
<ul>
<li class="chapter" data-level="5.1" data-path="glm-2.html"><a href="glm-2.html#second-half-of-each-run"><i class="fa fa-check"></i><b>5.1</b> Second half of each run</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="glm-2.html"><a href="glm-2.html#parametric-modulation-with-cosine-regressor"><i class="fa fa-check"></i><b>5.1.1</b> Parametric modulation with cosine regressor</a></li>
<li class="chapter" data-level="5.1.2" data-path="glm-2.html"><a href="glm-2.html#set-up-the-glm-using-fsl-feat-1"><i class="fa fa-check"></i><b>5.1.2</b> Set up the GLM using FSL FEAT</a></li>
<li class="chapter" data-level="5.1.3" data-path="glm-2.html"><a href="glm-2.html#run-glm2"><i class="fa fa-check"></i><b>5.1.3</b> Run GLM2</a></li>
<li class="chapter" data-level="5.1.4" data-path="glm-2.html"><a href="glm-2.html#glm-2-results"><i class="fa fa-check"></i><b>5.1.4</b> GLM 2 results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="credit.html"><a href="credit.html"><i class="fa fa-check"></i><b>6</b> Credit</a>
<ul>
<li class="chapter" data-level="6.1" data-path="credit.html"><a href="credit.html#gridcat"><i class="fa fa-check"></i><b>6.1</b> GridCAT</a></li>
<li class="chapter" data-level="6.2" data-path="credit.html"><a href="credit.html#hosting-on-gitpages"><i class="fa fa-check"></i><b>6.2</b> Hosting on GitPages</a></li>
<li class="chapter" data-level="6.3" data-path="credit.html"><a href="credit.html#publishing-on-github-pages"><i class="fa fa-check"></i><b>6.3</b> Publishing on GitHub Pages</a></li>
<li class="chapter" data-level="6.4" data-path="credit.html"><a href="credit.html#list-of-r-packages"><i class="fa fa-check"></i><b>6.4</b> List of R packages</a></li>
<li class="chapter" data-level="6.5" data-path="credit.html"><a href="credit.html#references"><i class="fa fa-check"></i><b>6.5</b> References</a></li>
<li class="chapter" data-level="6.6" data-path="credit.html"><a href="credit.html#session-info"><i class="fa fa-check"></i><b>6.6</b> Session Info</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Detecting Hexadirectional Signals in the Human Brain using R and FSL</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example-data" class="section level1" number="2">
<h1><span class="header-section-number">2</span> Example Data</h1>
<p>To run the analysis, we want to use example data provided with the <a href="https://www.nitrc.org/projects/gridcat">GridCAT toolbox</a>.</p>
<div id="download-example-data" class="section level2" number="2.1">
<h2><span class="header-section-number">2.1</span> Download Example Data</h2>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="example-data.html#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create data folder if needed</span></span>
<span id="cb2-2"><a href="example-data.html#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))){<span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))}</span>
<span id="cb2-3"><a href="example-data.html#cb2-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-4"><a href="example-data.html#cb2-4" aria-hidden="true" tabindex="-1"></a><span class="co"># download the zipped example data</span></span>
<span id="cb2-5"><a href="example-data.html#cb2-5" aria-hidden="true" tabindex="-1"></a>zip_fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;example_data.zip&quot;</span>)</span>
<span id="cb2-6"><a href="example-data.html#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(zip_fn)){</span>
<span id="cb2-7"><a href="example-data.html#cb2-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-8"><a href="example-data.html#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sometimes download takes longer than default of 60s, so set to 300s</span></span>
<span id="cb2-9"><a href="example-data.html#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">timeout=</span><span class="dv">300</span>) </span>
<span id="cb2-10"><a href="example-data.html#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(<span class="at">url=</span><span class="st">&quot;https://www.nitrc.org/frs/download.php/9738/ExampleData.zip//?i_agree=1&amp;download_now=1&quot;</span>, </span>
<span id="cb2-11"><a href="example-data.html#cb2-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> zip_fn)</span>
<span id="cb2-12"><a href="example-data.html#cb2-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb2-13"><a href="example-data.html#cb2-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unpack</span></span>
<span id="cb2-14"><a href="example-data.html#cb2-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(zip_fn, <span class="at">exdir =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))</span>
<span id="cb2-15"><a href="example-data.html#cb2-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="rearrange-data" class="section level2" number="2.2">
<h2><span class="header-section-number">2.2</span> Rearrange data</h2>
<p>To make things look a bit more realistic, let’s rearrange some of the folders. For now, we will only be operating with one subject that has two runs.</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="example-data.html#cb3-1" aria-hidden="true" tabindex="-1"></a>subjects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sub01&quot;</span>)</span>
<span id="cb3-2"><a href="example-data.html#cb3-2" aria-hidden="true" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;run01&quot;</span>, <span class="st">&quot;run02&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="example-data.html#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="co"># realignment parameters</span></span>
<span id="cb4-2"><a href="example-data.html#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>, <span class="st">&quot;sub01&quot;</span>))){</span>
<span id="cb4-3"><a href="example-data.html#cb4-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>, <span class="st">&quot;sub01&quot;</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-4"><a href="example-data.html#cb4-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ExampleData&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-5"><a href="example-data.html#cb4-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>, <span class="st">&quot;sub01&quot;</span>))</span>
<span id="cb4-6"><a href="example-data.html#cb4-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">file.rename</span>(<span class="at">from=</span><span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>, <span class="st">&quot;sub01&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-7"><a href="example-data.html#cb4-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>, <span class="st">&quot;sub01&quot;</span>, </span>
<span id="cb4-8"><a href="example-data.html#cb4-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(<span class="st">&quot;realignmentParameters_&quot;</span>, runs, <span class="st">&quot;.txt&quot;</span>))))</span>
<span id="cb4-9"><a href="example-data.html#cb4-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb4-10"><a href="example-data.html#cb4-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-11"><a href="example-data.html#cb4-11" aria-hidden="true" tabindex="-1"></a><span class="co"># event tables</span></span>
<span id="cb4-12"><a href="example-data.html#cb4-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, <span class="st">&quot;sub01&quot;</span>))){</span>
<span id="cb4-13"><a href="example-data.html#cb4-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, <span class="st">&quot;sub01&quot;</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-14"><a href="example-data.html#cb4-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ExampleData&quot;</span>, <span class="st">&quot;EventTables&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-15"><a href="example-data.html#cb4-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, <span class="st">&quot;sub01&quot;</span>))</span>
<span id="cb4-16"><a href="example-data.html#cb4-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">file.rename</span>(<span class="at">from=</span><span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, <span class="st">&quot;sub01&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>),</span>
<span id="cb4-17"><a href="example-data.html#cb4-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;eventTable_&quot;</span>, runs, <span class="st">&quot;.txt&quot;</span>))))</span>
<span id="cb4-18"><a href="example-data.html#cb4-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-19"><a href="example-data.html#cb4-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-20"><a href="example-data.html#cb4-20" aria-hidden="true" tabindex="-1"></a><span class="co"># EC ROIs</span></span>
<span id="cb4-21"><a href="example-data.html#cb4-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;ROI_masks&quot;</span>))){</span>
<span id="cb4-22"><a href="example-data.html#cb4-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;ROI_masks&quot;</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-23"><a href="example-data.html#cb4-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ExampleData&quot;</span>, <span class="st">&quot;ROI_masks&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-24"><a href="example-data.html#cb4-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;ROI_masks&quot;</span>))</span>
<span id="cb4-25"><a href="example-data.html#cb4-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-26"><a href="example-data.html#cb4-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-27"><a href="example-data.html#cb4-27" aria-hidden="true" tabindex="-1"></a><span class="co"># fMRI data run 1</span></span>
<span id="cb4-28"><a href="example-data.html#cb4-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run01&quot;</span>))){</span>
<span id="cb4-29"><a href="example-data.html#cb4-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>,  <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run01&quot;</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-30"><a href="example-data.html#cb4-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ExampleData&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;run1&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-31"><a href="example-data.html#cb4-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>,  <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run01&quot;</span>)))</span>
<span id="cb4-32"><a href="example-data.html#cb4-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb4-33"><a href="example-data.html#cb4-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-34"><a href="example-data.html#cb4-34" aria-hidden="true" tabindex="-1"></a><span class="co"># fMRI data run 2</span></span>
<span id="cb4-35"><a href="example-data.html#cb4-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run02&quot;</span>))){</span>
<span id="cb4-36"><a href="example-data.html#cb4-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>,  <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run02&quot;</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb4-37"><a href="example-data.html#cb4-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ExampleData&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;run2&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>), </span>
<span id="cb4-38"><a href="example-data.html#cb4-38" aria-hidden="true" tabindex="-1"></a>                      <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run02&quot;</span>)))</span>
<span id="cb4-39"><a href="example-data.html#cb4-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="event-tables" class="section level2" number="2.3">
<h2><span class="header-section-number">2.3</span> Event Tables</h2>
<p>The event tables in the example data are in a slightly strange format with some missing values (i.e. no angle information for feedback events). Because these missing values are not NAs but literally empty, loading the files results in warnings about parsing issues. We write them to a file where the missing values are replaced with NAs.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="example-data.html#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize empty tibble to collect all event tables</span></span>
<span id="cb5-2"><a href="example-data.html#cb5-2" aria-hidden="true" tabindex="-1"></a>event_table_full <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb5-3"><a href="example-data.html#cb5-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-4"><a href="example-data.html#cb5-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_sub <span class="cf">in</span> subjects){</span>
<span id="cb5-5"><a href="example-data.html#cb5-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-6"><a href="example-data.html#cb5-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_run <span class="cf">in</span> runs){</span>
<span id="cb5-7"><a href="example-data.html#cb5-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-8"><a href="example-data.html#cb5-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># read the data and add column names</span></span>
<span id="cb5-9"><a href="example-data.html#cb5-9" aria-hidden="true" tabindex="-1"></a>    fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, i_sub, <span class="fu">paste0</span>(<span class="st">&quot;eventTable_&quot;</span>, i_run, <span class="st">&quot;.txt&quot;</span>))</span>
<span id="cb5-10"><a href="example-data.html#cb5-10" aria-hidden="true" tabindex="-1"></a>    event_table <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(fn, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>, <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">&quot;fddd&quot;</span>))</span>
<span id="cb5-11"><a href="example-data.html#cb5-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(event_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;onset&quot;</span>, <span class="st">&quot;duration&quot;</span>, <span class="st">&quot;angle&quot;</span>)</span>
<span id="cb5-12"><a href="example-data.html#cb5-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-13"><a href="example-data.html#cb5-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># write to file</span></span>
<span id="cb5-14"><a href="example-data.html#cb5-14" aria-hidden="true" tabindex="-1"></a>    fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, i_sub, <span class="fu">paste0</span>(<span class="st">&quot;eventTable_&quot;</span>, i_run, <span class="st">&quot;_jb.txt&quot;</span>))</span>
<span id="cb5-15"><a href="example-data.html#cb5-15" aria-hidden="true" tabindex="-1"></a>    event_table <span class="sc">%&gt;%</span></span>
<span id="cb5-16"><a href="example-data.html#cb5-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write_delim</span>(<span class="at">file =</span> fn, <span class="at">delim =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb5-17"><a href="example-data.html#cb5-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb5-18"><a href="example-data.html#cb5-18" aria-hidden="true" tabindex="-1"></a>    event_table <span class="ot">&lt;-</span> event_table <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">subID =</span> i_sub, <span class="at">run =</span> i_run)</span>
<span id="cb5-19"><a href="example-data.html#cb5-19" aria-hidden="true" tabindex="-1"></a>    event_table_full <span class="ot">&lt;-</span> <span class="fu">rbind</span>(event_table_full, event_table)</span>
<span id="cb5-20"><a href="example-data.html#cb5-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb5-21"><a href="example-data.html#cb5-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Warning: One or more parsing issues, see `problems()` for details

## Warning: One or more parsing issues, see `problems()` for details</code></pre>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="example-data.html#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(event_table_full)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   name        onset duration angle subID run  
##   &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
## 1 translation  3.00     5.90 175.  sub01 run01
## 2 translation 17.9      3.43 275.  sub01 run01
## 3 feedback    24.0      2.03  NA   sub01 run01
## 4 translation 26.1      4.08  58.6 sub01 run01
## 5 translation 31.5      3.23  58.6 sub01 run01
## 6 translation 35.9      3.11 112.  sub01 run01</code></pre>
<p>For each translation (navigation) event, the event table has a duration and and angle value. As we don’t have the raw navigation data, all we can do here is plot overview of the lengths and directions of the trajectories.</p>
<p>When working with actual data, we will have to make decisions about how to define a trajectory event and how to label it with an angle. This is particularly complex if participants travel in long paths with curves so that they navigate in multiple directions in a translation event. We might want to do some reading here to check how other people did this.</p>
<div id="trajectory-duration" class="section level3" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Trajectory duration</h3>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="example-data.html#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we are only interested in the trajectory events </span></span>
<span id="cb9-2"><a href="example-data.html#cb9-2" aria-hidden="true" tabindex="-1"></a>trajectory_events <span class="ot">&lt;-</span> event_table_full <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;translation&quot;</span>)</span>
<span id="cb9-3"><a href="example-data.html#cb9-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-4"><a href="example-data.html#cb9-4" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of durations</span></span>
<span id="cb9-5"><a href="example-data.html#cb9-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trajectory_events, <span class="fu">aes</span>(<span class="at">x=</span>duration)) <span class="sc">+</span></span>
<span id="cb9-6"><a href="example-data.html#cb9-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb9-7"><a href="example-data.html#cb9-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(subID <span class="sc">~</span> run) <span class="sc">+</span></span>
<span id="cb9-8"><a href="example-data.html#cb9-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Duration of translation events&quot;</span>) <span class="sc">+</span></span>
<span id="cb9-9"><a href="example-data.html#cb9-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="Hexadirectioal-analysis-pipeline_files/figure-html/trajectory_duration-1.png" width="672" /></p>
</div>
<div id="angular-sampling" class="section level3" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Angular Sampling</h3>
<p>One thing we want to be sure of is that all trajectory directions were sampled somewhat evenly. To do visualize the angular sampling, we plot a polar histogram with 36 bins (10 degree width).</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="example-data.html#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make polar histogram across trajectory event angles</span></span>
<span id="cb10-2"><a href="example-data.html#cb10-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trajectory_events, <span class="fu">aes</span>(<span class="at">x=</span>angle)) <span class="sc">+</span></span>
<span id="cb10-3"><a href="example-data.html#cb10-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>() <span class="sc">+</span></span>
<span id="cb10-4"><a href="example-data.html#cb10-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">360</span>)) <span class="sc">+</span></span>
<span id="cb10-5"><a href="example-data.html#cb10-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">bins =</span> <span class="dv">36</span>) <span class="sc">+</span></span>
<span id="cb10-6"><a href="example-data.html#cb10-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(subID <span class="sc">~</span> run) <span class="sc">+</span></span>
<span id="cb10-7"><a href="example-data.html#cb10-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Trajectory directions&quot;</span>) <span class="sc">+</span></span>
<span id="cb10-8"><a href="example-data.html#cb10-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 2 row(s) containing missing values (geom_path).</code></pre>
<p><img src="Hexadirectioal-analysis-pipeline_files/figure-html/ang_sampling_hist-1.png" width="672" /></p>
<p>We can also test statistically if our angular sampling deviates from uniformity using a Rayleigh’s test. This test is implemented below for the entire set of samples (i.e. collapsed across runs).</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="example-data.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rayleigh test of uniformity</span></span>
<span id="cb12-2"><a href="example-data.html#cb12-2" aria-hidden="true" tabindex="-1"></a>circular<span class="sc">::</span><span class="fu">rayleigh.test</span>(<span class="fu">circular</span>(trajectory_events<span class="sc">$</span>angle, <span class="at">type=</span><span class="st">&quot;angles&quot;</span>, <span class="at">units =</span> <span class="st">&quot;degrees&quot;</span>))</span></code></pre></div>
<pre><code>## 
##        Rayleigh Test of Uniformity 
##        General Unimodal Alternative 
## 
## Test Statistic:  0.0378 
## P-value:  0.7299</code></pre>
</div>
</div>
<div id="fmri" class="section level2" number="2.4">
<h2><span class="header-section-number">2.4</span> fMRI</h2>
<div id="merge-images-of-each-run" class="section level3" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Merge images of each run</h3>
<p>We have two runs of fMRI data from a navigation task. Because the toolbox is built for SPM, each volume is a separate file. Because this is annoying, let’s merge the images of each run to one 4-D file.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="example-data.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_sub <span class="cf">in</span> subjects){</span>
<span id="cb14-2"><a href="example-data.html#cb14-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_run <span class="cf">in</span> runs){</span>
<span id="cb14-3"><a href="example-data.html#cb14-3" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb14-4"><a href="example-data.html#cb14-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create folder for 4D images if necessary</span></span>
<span id="cb14-5"><a href="example-data.html#cb14-5" aria-hidden="true" tabindex="-1"></a>    fmri_4d_dir <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;4D&quot;</span>, i_sub, i_run)</span>
<span id="cb14-6"><a href="example-data.html#cb14-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(fmri_4d_dir)){<span class="fu">dir.create</span>(fmri_4d_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)} </span>
<span id="cb14-7"><a href="example-data.html#cb14-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb14-8"><a href="example-data.html#cb14-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># merge the individual niftis into 4D timeseries</span></span>
<span id="cb14-9"><a href="example-data.html#cb14-9" aria-hidden="true" tabindex="-1"></a>    fn <span class="ot">&lt;-</span> <span class="fu">file.path</span>(fmri_4d_dir, <span class="fu">paste0</span>(i_run, <span class="st">&quot;.nii.gz&quot;</span>))</span>
<span id="cb14-10"><a href="example-data.html#cb14-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fn)){</span>
<span id="cb14-11"><a href="example-data.html#cb14-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb14-12"><a href="example-data.html#cb14-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># find all the files and merge them using fslmerge</span></span>
<span id="cb14-13"><a href="example-data.html#cb14-13" aria-hidden="true" tabindex="-1"></a>      in_files <span class="ot">&lt;-</span> <span class="fu">dir</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;3D&quot;</span>, i_sub, i_run), </span>
<span id="cb14-14"><a href="example-data.html#cb14-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-15"><a href="example-data.html#cb14-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fslmerge</span>(in_files, <span class="at">outfile =</span> fn,</span>
<span id="cb14-16"><a href="example-data.html#cb14-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">retimg =</span> <span class="cn">FALSE</span>, <span class="at">direction =</span> <span class="st">&quot;t&quot;</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb14-17"><a href="example-data.html#cb14-17" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb14-18"><a href="example-data.html#cb14-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># let&#39;s have a look at the first volume of the 4D image</span></span>
<span id="cb14-19"><a href="example-data.html#cb14-19" aria-hidden="true" tabindex="-1"></a>      run_nii <span class="ot">&lt;-</span> <span class="fu">readNIfTI2</span>(fn)</span>
<span id="cb14-20"><a href="example-data.html#cb14-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ortho2</span>(run_nii[,,,<span class="dv">1</span>], <span class="at">add.orient =</span> <span class="cn">TRUE</span>)</span>
<span id="cb14-21"><a href="example-data.html#cb14-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb14-22"><a href="example-data.html#cb14-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#system(sprintf(&quot;fslmerge -tr %s %s 1.5&quot;, fn, fn))</span></span>
<span id="cb14-23"><a href="example-data.html#cb14-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb14-24"><a href="example-data.html#cb14-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="calculate-tsnr" class="section level3" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Calculate tSNR</h3>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="example-data.html#cb15-1" aria-hidden="true" tabindex="-1"></a>calc_tSNR <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">fourD_fn=</span><span class="cn">NULL</span>, <span class="at">tMean_fn=</span><span class="cn">NULL</span>, <span class="at">tStd_fn=</span><span class="cn">NULL</span>, <span class="at">tSNR_fn=</span><span class="cn">NULL</span>){</span>
<span id="cb15-2"><a href="example-data.html#cb15-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb15-3"><a href="example-data.html#cb15-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate temporal mean for each voxel</span></span>
<span id="cb15-4"><a href="example-data.html#cb15-4" aria-hidden="true" tabindex="-1"></a>  fslr<span class="sc">::</span><span class="fu">fsl_maths</span>(<span class="at">file =</span> fourD_fn, <span class="at">opts =</span> <span class="st">&quot;-Tmean&quot;</span>, <span class="at">outfile =</span> tMean_fn,</span>
<span id="cb15-5"><a href="example-data.html#cb15-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">retimg =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-6"><a href="example-data.html#cb15-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate temporal mean for each voxel</span></span>
<span id="cb15-7"><a href="example-data.html#cb15-7" aria-hidden="true" tabindex="-1"></a>  fslr<span class="sc">::</span><span class="fu">fsl_maths</span>(<span class="at">file =</span> fourD_fn, <span class="at">opts =</span> <span class="st">&quot;-Tstd&quot;</span>, <span class="at">outfile =</span> tStd_fn,</span>
<span id="cb15-8"><a href="example-data.html#cb15-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">retimg =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-9"><a href="example-data.html#cb15-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate tSNR for each voxel</span></span>
<span id="cb15-10"><a href="example-data.html#cb15-10" aria-hidden="true" tabindex="-1"></a>  fslr<span class="sc">::</span><span class="fu">fsl_div</span>(<span class="at">file =</span> tMean_fn, <span class="at">file2 =</span> tStd_fn, <span class="at">outfile =</span> tSNR_fn,</span>
<span id="cb15-11"><a href="example-data.html#cb15-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">retimg =</span> <span class="cn">FALSE</span>)</span>
<span id="cb15-12"><a href="example-data.html#cb15-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb15-13"><a href="example-data.html#cb15-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-14"><a href="example-data.html#cb15-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_sub <span class="cf">in</span> subjects){</span>
<span id="cb15-15"><a href="example-data.html#cb15-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_run <span class="cf">in</span> runs){</span>
<span id="cb15-16"><a href="example-data.html#cb15-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb15-17"><a href="example-data.html#cb15-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create folder for SNR images if necessary</span></span>
<span id="cb15-18"><a href="example-data.html#cb15-18" aria-hidden="true" tabindex="-1"></a>    snr_dir <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;snr&quot;</span>, i_sub, i_run)</span>
<span id="cb15-19"><a href="example-data.html#cb15-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(snr_dir)){<span class="fu">dir.create</span>(snr_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)} </span>
<span id="cb15-20"><a href="example-data.html#cb15-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-21"><a href="example-data.html#cb15-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">file.path</span>(snr_dir, <span class="st">&quot;tSNR.nii.gz&quot;</span>))){</span>
<span id="cb15-22"><a href="example-data.html#cb15-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># calculate tSNR</span></span>
<span id="cb15-23"><a href="example-data.html#cb15-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">calc_tSNR</span>(<span class="at">fourD_fn =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;4D&quot;</span>, </span>
<span id="cb15-24"><a href="example-data.html#cb15-24" aria-hidden="true" tabindex="-1"></a>                                i_sub, i_run, <span class="fu">paste0</span>(i_run, <span class="st">&quot;.nii.gz&quot;</span>)),</span>
<span id="cb15-25"><a href="example-data.html#cb15-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">tMean_fn =</span> <span class="fu">file.path</span>(snr_dir, <span class="st">&quot;tMean.nii.gz&quot;</span>), </span>
<span id="cb15-26"><a href="example-data.html#cb15-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">tStd_fn =</span> <span class="fu">file.path</span>(snr_dir, <span class="st">&quot;tStd.nii.gz&quot;</span>), </span>
<span id="cb15-27"><a href="example-data.html#cb15-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">tSNR_fn =</span> <span class="fu">file.path</span>(snr_dir, <span class="st">&quot;tSNR.nii.gz&quot;</span>))</span>
<span id="cb15-28"><a href="example-data.html#cb15-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb15-29"><a href="example-data.html#cb15-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb15-30"><a href="example-data.html#cb15-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="create-quick-brain-mask" class="section level3" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Create quick brain mask</h3>
<p>To speed up the GLM, let’s quickly create a brain mask based on the temporal mean image that we can use to mask the functional images. After eye-balling the image, we use a value of 100 to create the mask.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="example-data.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_sub <span class="cf">in</span> subjects){</span>
<span id="cb16-2"><a href="example-data.html#cb16-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_run <span class="cf">in</span> runs){</span>
<span id="cb16-3"><a href="example-data.html#cb16-3" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb16-4"><a href="example-data.html#cb16-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create folder for mask images if necessary</span></span>
<span id="cb16-5"><a href="example-data.html#cb16-5" aria-hidden="true" tabindex="-1"></a>    mask_dir <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;brain_mask&quot;</span>, i_sub, i_run)</span>
<span id="cb16-6"><a href="example-data.html#cb16-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(mask_dir)){<span class="fu">dir.create</span>(mask_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)}</span>
<span id="cb16-7"><a href="example-data.html#cb16-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb16-8"><a href="example-data.html#cb16-8" aria-hidden="true" tabindex="-1"></a>    mask_fn <span class="ot">&lt;-</span> <span class="fu">file.path</span>(mask_dir, <span class="st">&quot;brain_mask_tMean100.nii.gz&quot;</span>)</span>
<span id="cb16-9"><a href="example-data.html#cb16-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mask_fn)){</span>
<span id="cb16-10"><a href="example-data.html#cb16-10" aria-hidden="true" tabindex="-1"></a>      mask_nii <span class="ot">&lt;-</span> <span class="fu">fslthresh</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;snr&quot;</span>, i_sub, i_run, <span class="st">&quot;tMean.nii.gz&quot;</span>),</span>
<span id="cb16-11"><a href="example-data.html#cb16-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">outfile =</span> mask_fn,</span>
<span id="cb16-12"><a href="example-data.html#cb16-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">thresh =</span> <span class="dv">100</span>, <span class="at">opts =</span> <span class="st">&quot;-bin&quot;</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb16-13"><a href="example-data.html#cb16-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ortho2</span>(mask_nii)</span>
<span id="cb16-14"><a href="example-data.html#cb16-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb16-15"><a href="example-data.html#cb16-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb16-16"><a href="example-data.html#cb16-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a joint mask</span></span>
<span id="cb16-17"><a href="example-data.html#cb16-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the code below will only work correctly for two runs!</span></span>
<span id="cb16-18"><a href="example-data.html#cb16-18" aria-hidden="true" tabindex="-1"></a>  mask_fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;brain_mask&quot;</span>, i_sub, runs, <span class="st">&quot;brain_mask_tMean100.nii.gz&quot;</span>)</span>
<span id="cb16-19"><a href="example-data.html#cb16-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fslmul</span>(mask_fn[<span class="dv">1</span>], mask_fn[<span class="dv">2</span>], </span>
<span id="cb16-20"><a href="example-data.html#cb16-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">outfile =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;brain_mask&quot;</span>, i_sub, <span class="st">&quot;comb_brain_mask_tMean100.nii.gz&quot;</span>),</span>
<span id="cb16-21"><a href="example-data.html#cb16-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">retimg =</span> <span class="cn">FALSE</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb16-22"><a href="example-data.html#cb16-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="mask-4d-functionals" class="section level3" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Mask 4D functionals</h3>
<p>To speed up the GLM, we use the mask created above to mask out non-brain voxels from the functional images.</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="example-data.html#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_sub <span class="cf">in</span> subjects){</span>
<span id="cb17-2"><a href="example-data.html#cb17-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_run <span class="cf">in</span> runs){</span>
<span id="cb17-3"><a href="example-data.html#cb17-3" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-4"><a href="example-data.html#cb17-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create folder for mask images if necessary</span></span>
<span id="cb17-5"><a href="example-data.html#cb17-5" aria-hidden="true" tabindex="-1"></a>    func4d_dir <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;4D&quot;</span>, i_sub, i_run)</span>
<span id="cb17-6"><a href="example-data.html#cb17-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-7"><a href="example-data.html#cb17-7" aria-hidden="true" tabindex="-1"></a>    masked4D_fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;4D&quot;</span>, i_sub, i_run, </span>
<span id="cb17-8"><a href="example-data.html#cb17-8" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste0</span>(i_run, <span class="st">&quot;_masked.nii.gz&quot;</span>))</span>
<span id="cb17-9"><a href="example-data.html#cb17-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(masked4D_fn)){</span>
<span id="cb17-10"><a href="example-data.html#cb17-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb17-11"><a href="example-data.html#cb17-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fslmask</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;4D&quot;</span>, i_sub, i_run, </span>
<span id="cb17-12"><a href="example-data.html#cb17-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">paste0</span>(i_run, <span class="st">&quot;.nii.gz&quot;</span>)),</span>
<span id="cb17-13"><a href="example-data.html#cb17-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">mask =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;brain_mask&quot;</span>, i_sub, i_run,</span>
<span id="cb17-14"><a href="example-data.html#cb17-14" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;brain_mask_tMean100.nii.gz&quot;</span>),</span>
<span id="cb17-15"><a href="example-data.html#cb17-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">outfile =</span> masked4D_fn,</span>
<span id="cb17-16"><a href="example-data.html#cb17-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">retimg =</span> <span class="cn">FALSE</span>)</span>
<span id="cb17-17"><a href="example-data.html#cb17-17" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb17-18"><a href="example-data.html#cb17-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># let&#39;s have a look at the first volume of the resulting masked 4D image</span></span>
<span id="cb17-19"><a href="example-data.html#cb17-19" aria-hidden="true" tabindex="-1"></a>      run_nii <span class="ot">&lt;-</span> <span class="fu">readNIfTI2</span>(masked4D_fn)</span>
<span id="cb17-20"><a href="example-data.html#cb17-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ortho2</span>(run_nii[,,,<span class="dv">1</span>], <span class="at">add.orient =</span> <span class="cn">TRUE</span>)</span>
<span id="cb17-21"><a href="example-data.html#cb17-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb17-22"><a href="example-data.html#cb17-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb17-23"><a href="example-data.html#cb17-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="glm-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
