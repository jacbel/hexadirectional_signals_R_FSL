<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>2 Example Data | Detecting Hexadirectional Signals in the Human Brain using R and FSL</title>
  <meta name="description" content="2 Example Data | Detecting Hexadirectional Signals in the Human Brain using R and FSL" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="2 Example Data | Detecting Hexadirectional Signals in the Human Brain using R and FSL" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="2 Example Data | Detecting Hexadirectional Signals in the Human Brain using R and FSL" />
  
  
  

<meta name="author" content="Dr. Jacob L. S. Bellmund" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="index.html"/>
<link rel="next" href="glm-1.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Overview</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#requirements"><i class="fa fa-check"></i><b>1.1</b> Requirements</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#workflow"><i class="fa fa-check"></i><b>1.2</b> Workflow</a>
<ul>
<li class="chapter" data-level="1.2.1" data-path="index.html"><a href="index.html#cbs-imac-or-macbook"><i class="fa fa-check"></i><b>1.2.1</b> CBS iMac or Macbook</a></li>
<li class="chapter" data-level="1.2.2" data-path="index.html"><a href="index.html#remote-linux"><i class="fa fa-check"></i><b>1.2.2</b> Remote Linux</a></li>
<li class="chapter" data-level="1.2.3" data-path="index.html"><a href="index.html#running-the-analysis"><i class="fa fa-check"></i><b>1.2.3</b> Running the analysis</a></li>
</ul></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#required-packages"><i class="fa fa-check"></i><b>1.3</b> Required packages</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="example-data.html"><a href="example-data.html"><i class="fa fa-check"></i><b>2</b> Example Data</a>
<ul>
<li class="chapter" data-level="2.1" data-path="example-data.html"><a href="example-data.html#download-example-data"><i class="fa fa-check"></i><b>2.1</b> Download Example Data</a></li>
<li class="chapter" data-level="2.2" data-path="example-data.html"><a href="example-data.html#rearrange-data"><i class="fa fa-check"></i><b>2.2</b> Rearrange data</a></li>
<li class="chapter" data-level="2.3" data-path="example-data.html"><a href="example-data.html#event-tables"><i class="fa fa-check"></i><b>2.3</b> Event Tables</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="example-data.html"><a href="example-data.html#trajectory-duration"><i class="fa fa-check"></i><b>2.3.1</b> Trajectory duration</a></li>
<li class="chapter" data-level="2.3.2" data-path="example-data.html"><a href="example-data.html#angular-sampling"><i class="fa fa-check"></i><b>2.3.2</b> Angular Sampling</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="example-data.html"><a href="example-data.html#fmri"><i class="fa fa-check"></i><b>2.4</b> fMRI</a>
<ul>
<li class="chapter" data-level="2.4.1" data-path="example-data.html"><a href="example-data.html#merge-images-of-each-run"><i class="fa fa-check"></i><b>2.4.1</b> Merge images of each run</a></li>
<li class="chapter" data-level="2.4.2" data-path="example-data.html"><a href="example-data.html#calculate-tsnr"><i class="fa fa-check"></i><b>2.4.2</b> Calculate tSNR</a></li>
<li class="chapter" data-level="2.4.3" data-path="example-data.html"><a href="example-data.html#create-quick-brain-mask"><i class="fa fa-check"></i><b>2.4.3</b> Create quick brain mask</a></li>
<li class="chapter" data-level="2.4.4" data-path="example-data.html"><a href="example-data.html#mask-4d-functionals"><i class="fa fa-check"></i><b>2.4.4</b> Mask 4D functionals</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="glm-1.html"><a href="glm-1.html"><i class="fa fa-check"></i><b>3</b> GLM 1</a>
<ul>
<li class="chapter" data-level="3.1" data-path="glm-1.html"><a href="glm-1.html#ev-files-for-feat"><i class="fa fa-check"></i><b>3.1</b> EV files for FEAT</a></li>
<li class="chapter" data-level="3.2" data-path="glm-1.html"><a href="glm-1.html#set-up-the-glm-using-fsl-feat"><i class="fa fa-check"></i><b>3.2</b> Set up the GLM using FSL FEAT</a></li>
<li class="chapter" data-level="3.3" data-path="glm-1.html"><a href="glm-1.html#run-glm1"><i class="fa fa-check"></i><b>3.3</b> Run GLM1</a>
<ul>
<li class="chapter" data-level="3.3.1" data-path="glm-1.html"><a href="glm-1.html#feat"><i class="fa fa-check"></i><b>3.3.1</b> FEAT</a></li>
<li class="chapter" data-level="3.3.2" data-path="glm-1.html"><a href="glm-1.html#film_gls"><i class="fa fa-check"></i><b>3.3.2</b> FILM_GLS</a></li>
</ul></li>
<li class="chapter" data-level="3.4" data-path="glm-1.html"><a href="glm-1.html#results-glm-1"><i class="fa fa-check"></i><b>3.4</b> Results GLM 1</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="glm-1.html"><a href="glm-1.html#compare-results-from-feat-and-film"><i class="fa fa-check"></i><b>3.4.1</b> Compare results from FEAT and FILM</a></li>
<li class="chapter" data-level="3.4.2" data-path="glm-1.html"><a href="glm-1.html#f-test-results"><i class="fa fa-check"></i><b>3.4.2</b> F-Test results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="estimate-orientation.html"><a href="estimate-orientation.html"><i class="fa fa-check"></i><b>4</b> Estimate orientation</a>
<ul>
<li class="chapter" data-level="4.1" data-path="estimate-orientation.html"><a href="estimate-orientation.html#load-pes-of-parametric-modulators"><i class="fa fa-check"></i><b>4.1</b> Load PEs of parametric modulators</a></li>
<li class="chapter" data-level="4.2" data-path="estimate-orientation.html"><a href="estimate-orientation.html#compute-voxelwise-orientation"><i class="fa fa-check"></i><b>4.2</b> Compute Voxelwise Orientation</a></li>
<li class="chapter" data-level="4.3" data-path="estimate-orientation.html"><a href="estimate-orientation.html#average-grid-orientations"><i class="fa fa-check"></i><b>4.3</b> Average grid orientations</a>
<ul>
<li class="chapter" data-level="4.3.1" data-path="estimate-orientation.html"><a href="estimate-orientation.html#wholebrain-average-orientation"><i class="fa fa-check"></i><b>4.3.1</b> Wholebrain average orientation</a></li>
<li class="chapter" data-level="4.3.2" data-path="estimate-orientation.html"><a href="estimate-orientation.html#entorhinal-cortex-average-orientation"><i class="fa fa-check"></i><b>4.3.2</b> Entorhinal Cortex average orientation</a></li>
</ul></li>
<li class="chapter" data-level="4.4" data-path="estimate-orientation.html"><a href="estimate-orientation.html#brain-plot-of-estimated-orientations"><i class="fa fa-check"></i><b>4.4</b> Brain plot of estimated orientations</a></li>
<li class="chapter" data-level="4.5" data-path="estimate-orientation.html"><a href="estimate-orientation.html#store-estimated-grid-orientation"><i class="fa fa-check"></i><b>4.5</b> Store estimated grid orientation</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="glm-2.html"><a href="glm-2.html"><i class="fa fa-check"></i><b>5</b> GLM 2</a>
<ul>
<li class="chapter" data-level="5.1" data-path="glm-2.html"><a href="glm-2.html#parametric-modulation-with-cosine-regressor"><i class="fa fa-check"></i><b>5.1</b> Parametric modulation with cosine regressor</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="glm-2.html"><a href="glm-2.html#ev-files-for-feat-1"><i class="fa fa-check"></i><b>5.1.1</b> EV files for FEAT</a></li>
<li class="chapter" data-level="5.1.2" data-path="glm-2.html"><a href="glm-2.html#set-up-the-glm-using-fsl-feat-1"><i class="fa fa-check"></i><b>5.1.2</b> Set up the GLM using FSL FEAT</a></li>
<li class="chapter" data-level="5.1.3" data-path="glm-2.html"><a href="glm-2.html#run-glm2"><i class="fa fa-check"></i><b>5.1.3</b> Run GLM2</a></li>
<li class="chapter" data-level="5.1.4" data-path="glm-2.html"><a href="glm-2.html#glm-2-results"><i class="fa fa-check"></i><b>5.1.4</b> GLM 2 results</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="credit.html"><a href="credit.html"><i class="fa fa-check"></i><b>6</b> Credit</a>
<ul>
<li class="chapter" data-level="6.1" data-path="credit.html"><a href="credit.html#gridcat"><i class="fa fa-check"></i><b>6.1</b> GridCAT</a></li>
<li class="chapter" data-level="6.2" data-path="credit.html"><a href="credit.html#publishing-on-github-pages"><i class="fa fa-check"></i><b>6.2</b> Publishing on GitHub Pages</a></li>
<li class="chapter" data-level="6.3" data-path="credit.html"><a href="credit.html#list-of-r-packages"><i class="fa fa-check"></i><b>6.3</b> List of R packages</a></li>
<li class="chapter" data-level="6.4" data-path="credit.html"><a href="credit.html#session-info"><i class="fa fa-check"></i><b>6.4</b> Session Info</a></li>
<li class="chapter" data-level="6.5" data-path="credit.html"><a href="credit.html#bibliography"><i class="fa fa-check"></i><b>6.5</b> Bibliography</a></li>
</ul></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Detecting Hexadirectional Signals in the Human Brain using R and FSL</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="example-data" class="section level1 hasAnchor" number="2">
<h1><span class="header-section-number">2</span> Example Data<a href="example-data.html#example-data" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>To run the analysis, we want to use example data provided with the <a href="https://www.nitrc.org/projects/gridcat">GridCAT toolbox</a>.</p>
<div id="download-example-data" class="section level2 hasAnchor" number="2.1">
<h2><span class="header-section-number">2.1</span> Download Example Data<a href="example-data.html#download-example-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="example-data.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># create data folder if needed</span></span>
<span id="cb33-2"><a href="example-data.html#cb33-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))){<span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))}</span>
<span id="cb33-3"><a href="example-data.html#cb33-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-4"><a href="example-data.html#cb33-4" aria-hidden="true" tabindex="-1"></a><span class="co"># download the zipped example data</span></span>
<span id="cb33-5"><a href="example-data.html#cb33-5" aria-hidden="true" tabindex="-1"></a>zip_fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;example_data.zip&quot;</span>)</span>
<span id="cb33-6"><a href="example-data.html#cb33-6" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(zip_fn)){</span>
<span id="cb33-7"><a href="example-data.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-8"><a href="example-data.html#cb33-8" aria-hidden="true" tabindex="-1"></a>  <span class="co"># sometimes download takes longer than default of 60s, so set to 300s</span></span>
<span id="cb33-9"><a href="example-data.html#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">options</span>(<span class="at">timeout=</span><span class="dv">300</span>) </span>
<span id="cb33-10"><a href="example-data.html#cb33-10" aria-hidden="true" tabindex="-1"></a>  <span class="fu">download.file</span>(<span class="at">url=</span><span class="st">&quot;https://www.nitrc.org/frs/download.php/9738/ExampleData.zip//?i_agree=1&amp;download_now=1&quot;</span>, </span>
<span id="cb33-11"><a href="example-data.html#cb33-11" aria-hidden="true" tabindex="-1"></a>              <span class="at">destfile =</span> zip_fn)</span>
<span id="cb33-12"><a href="example-data.html#cb33-12" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb33-13"><a href="example-data.html#cb33-13" aria-hidden="true" tabindex="-1"></a>  <span class="co"># unpack</span></span>
<span id="cb33-14"><a href="example-data.html#cb33-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">unzip</span>(zip_fn, <span class="at">exdir =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>))</span>
<span id="cb33-15"><a href="example-data.html#cb33-15" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="rearrange-data" class="section level2 hasAnchor" number="2.2">
<h2><span class="header-section-number">2.2</span> Rearrange data<a href="example-data.html#rearrange-data" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>To make things look a bit more realistic, let’s rearrange some of the folders. For now, we will only be operating with one subject that has two runs.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="example-data.html#cb34-1" aria-hidden="true" tabindex="-1"></a>subjects <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;sub01&quot;</span>)</span>
<span id="cb34-2"><a href="example-data.html#cb34-2" aria-hidden="true" tabindex="-1"></a>runs <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;run01&quot;</span>, <span class="st">&quot;run02&quot;</span>)</span></code></pre></div>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="example-data.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># realignment parameters</span></span>
<span id="cb35-2"><a href="example-data.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>, <span class="st">&quot;sub01&quot;</span>))){</span>
<span id="cb35-3"><a href="example-data.html#cb35-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>, <span class="st">&quot;sub01&quot;</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-4"><a href="example-data.html#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ExampleData&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-5"><a href="example-data.html#cb35-5" aria-hidden="true" tabindex="-1"></a>            <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>, <span class="st">&quot;sub01&quot;</span>))</span>
<span id="cb35-6"><a href="example-data.html#cb35-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">file.rename</span>(<span class="at">from=</span><span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>, <span class="st">&quot;sub01&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-7"><a href="example-data.html#cb35-7" aria-hidden="true" tabindex="-1"></a>                        <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;AdditionalRegressors&quot;</span>, <span class="st">&quot;sub01&quot;</span>, </span>
<span id="cb35-8"><a href="example-data.html#cb35-8" aria-hidden="true" tabindex="-1"></a>                                  <span class="fu">paste0</span>(<span class="st">&quot;realignmentParameters_&quot;</span>, runs, <span class="st">&quot;.txt&quot;</span>))))</span>
<span id="cb35-9"><a href="example-data.html#cb35-9" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb35-10"><a href="example-data.html#cb35-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-11"><a href="example-data.html#cb35-11" aria-hidden="true" tabindex="-1"></a><span class="co"># event tables</span></span>
<span id="cb35-12"><a href="example-data.html#cb35-12" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, <span class="st">&quot;sub01&quot;</span>))){</span>
<span id="cb35-13"><a href="example-data.html#cb35-13" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, <span class="st">&quot;sub01&quot;</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-14"><a href="example-data.html#cb35-14" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ExampleData&quot;</span>, <span class="st">&quot;EventTables&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-15"><a href="example-data.html#cb35-15" aria-hidden="true" tabindex="-1"></a>            <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, <span class="st">&quot;sub01&quot;</span>))</span>
<span id="cb35-16"><a href="example-data.html#cb35-16" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">file.rename</span>(<span class="at">from=</span><span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, <span class="st">&quot;sub01&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>),</span>
<span id="cb35-17"><a href="example-data.html#cb35-17" aria-hidden="true" tabindex="-1"></a>                        <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;eventTable_&quot;</span>, runs, <span class="st">&quot;.txt&quot;</span>))))</span>
<span id="cb35-18"><a href="example-data.html#cb35-18" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-19"><a href="example-data.html#cb35-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-20"><a href="example-data.html#cb35-20" aria-hidden="true" tabindex="-1"></a><span class="co"># EC ROIs</span></span>
<span id="cb35-21"><a href="example-data.html#cb35-21" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;ROI_masks&quot;</span>))){</span>
<span id="cb35-22"><a href="example-data.html#cb35-22" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;ROI_masks&quot;</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-23"><a href="example-data.html#cb35-23" aria-hidden="true" tabindex="-1"></a>  <span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ExampleData&quot;</span>, <span class="st">&quot;ROI_masks&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-24"><a href="example-data.html#cb35-24" aria-hidden="true" tabindex="-1"></a>            <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;ROI_masks&quot;</span>))</span>
<span id="cb35-25"><a href="example-data.html#cb35-25" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-26"><a href="example-data.html#cb35-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-27"><a href="example-data.html#cb35-27" aria-hidden="true" tabindex="-1"></a><span class="co"># fMRI data run 1</span></span>
<span id="cb35-28"><a href="example-data.html#cb35-28" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run01&quot;</span>))){</span>
<span id="cb35-29"><a href="example-data.html#cb35-29" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>,  <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run01&quot;</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-30"><a href="example-data.html#cb35-30" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ExampleData&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;run1&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-31"><a href="example-data.html#cb35-31" aria-hidden="true" tabindex="-1"></a>                      <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>,  <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run01&quot;</span>)))</span>
<span id="cb35-32"><a href="example-data.html#cb35-32" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb35-33"><a href="example-data.html#cb35-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-34"><a href="example-data.html#cb35-34" aria-hidden="true" tabindex="-1"></a><span class="co"># fMRI data run 2</span></span>
<span id="cb35-35"><a href="example-data.html#cb35-35" aria-hidden="true" tabindex="-1"></a><span class="cf">if</span>(<span class="sc">!</span><span class="fu">dir.exists</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run02&quot;</span>))){</span>
<span id="cb35-36"><a href="example-data.html#cb35-36" aria-hidden="true" tabindex="-1"></a>  <span class="fu">dir.create</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>,  <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run02&quot;</span>), <span class="at">recursive =</span> <span class="cn">TRUE</span>)</span>
<span id="cb35-37"><a href="example-data.html#cb35-37" aria-hidden="true" tabindex="-1"></a>  <span class="fu">invisible</span>(<span class="fu">file.copy</span>(<span class="at">from =</span> <span class="fu">list.files</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;ExampleData&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;run2&quot;</span>), <span class="at">full.names =</span> <span class="cn">TRUE</span>), </span>
<span id="cb35-38"><a href="example-data.html#cb35-38" aria-hidden="true" tabindex="-1"></a>                      <span class="at">to =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;3D&quot;</span>, <span class="st">&quot;sub01&quot;</span>, <span class="st">&quot;run02&quot;</span>)))</span>
<span id="cb35-39"><a href="example-data.html#cb35-39" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="event-tables" class="section level2 hasAnchor" number="2.3">
<h2><span class="header-section-number">2.3</span> Event Tables<a href="example-data.html#event-tables" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>The event tables in the example data are in a slightly strange format with some missing values (i.e. no angle information for feedback events). Because these missing values are not NAs but literally empty, loading the files results in warnings about parsing issues. We write them to a file where the missing values are replaced with NAs.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="example-data.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># initialize empty tibble to collect all event tables</span></span>
<span id="cb36-2"><a href="example-data.html#cb36-2" aria-hidden="true" tabindex="-1"></a>event_table_full <span class="ot">&lt;-</span> <span class="fu">tibble</span>()</span>
<span id="cb36-3"><a href="example-data.html#cb36-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-4"><a href="example-data.html#cb36-4" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_sub <span class="cf">in</span> subjects){</span>
<span id="cb36-5"><a href="example-data.html#cb36-5" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-6"><a href="example-data.html#cb36-6" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_run <span class="cf">in</span> runs){</span>
<span id="cb36-7"><a href="example-data.html#cb36-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-8"><a href="example-data.html#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># read the data and add column names</span></span>
<span id="cb36-9"><a href="example-data.html#cb36-9" aria-hidden="true" tabindex="-1"></a>    fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, i_sub, <span class="fu">paste0</span>(<span class="st">&quot;eventTable_&quot;</span>, i_run, <span class="st">&quot;.txt&quot;</span>))</span>
<span id="cb36-10"><a href="example-data.html#cb36-10" aria-hidden="true" tabindex="-1"></a>    event_table <span class="ot">&lt;-</span> <span class="fu">read_delim</span>(fn, <span class="at">delim =</span> <span class="st">&quot;;&quot;</span>, <span class="at">col_names =</span> <span class="cn">FALSE</span>, <span class="at">col_types =</span> <span class="fu">c</span>(<span class="st">&quot;fddd&quot;</span>))</span>
<span id="cb36-11"><a href="example-data.html#cb36-11" aria-hidden="true" tabindex="-1"></a>    <span class="fu">colnames</span>(event_table) <span class="ot">&lt;-</span> <span class="fu">c</span>(<span class="st">&quot;name&quot;</span>, <span class="st">&quot;onset&quot;</span>, <span class="st">&quot;duration&quot;</span>, <span class="st">&quot;angle&quot;</span>)</span>
<span id="cb36-12"><a href="example-data.html#cb36-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-13"><a href="example-data.html#cb36-13" aria-hidden="true" tabindex="-1"></a>    <span class="co"># write to file</span></span>
<span id="cb36-14"><a href="example-data.html#cb36-14" aria-hidden="true" tabindex="-1"></a>    fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;EventTables&quot;</span>, i_sub, <span class="fu">paste0</span>(<span class="st">&quot;eventTable_&quot;</span>, i_run, <span class="st">&quot;_jb.txt&quot;</span>))</span>
<span id="cb36-15"><a href="example-data.html#cb36-15" aria-hidden="true" tabindex="-1"></a>    event_table <span class="sc">%&gt;%</span></span>
<span id="cb36-16"><a href="example-data.html#cb36-16" aria-hidden="true" tabindex="-1"></a>      <span class="fu">write_delim</span>(<span class="at">file =</span> fn, <span class="at">delim =</span> <span class="st">&quot;</span><span class="sc">\t</span><span class="st">&quot;</span>, <span class="at">col_names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb36-17"><a href="example-data.html#cb36-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb36-18"><a href="example-data.html#cb36-18" aria-hidden="true" tabindex="-1"></a>    event_table <span class="ot">&lt;-</span> event_table <span class="sc">%&gt;%</span> <span class="fu">mutate</span>(<span class="at">subID =</span> i_sub, <span class="at">run =</span> i_run)</span>
<span id="cb36-19"><a href="example-data.html#cb36-19" aria-hidden="true" tabindex="-1"></a>    event_table_full <span class="ot">&lt;-</span> <span class="fu">rbind</span>(event_table_full, event_table)</span>
<span id="cb36-20"><a href="example-data.html#cb36-20" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb36-21"><a href="example-data.html#cb36-21" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
<pre><code>## Warning: One or more parsing issues, see `problems()` for details
## One or more parsing issues, see `problems()` for details</code></pre>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="example-data.html#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(event_table_full)</span></code></pre></div>
<pre><code>## # A tibble: 6 × 6
##   name        onset duration angle subID run  
##   &lt;fct&gt;       &lt;dbl&gt;    &lt;dbl&gt; &lt;dbl&gt; &lt;chr&gt; &lt;chr&gt;
## 1 translation  3.00     5.90 175.  sub01 run01
## 2 translation 17.9      3.43 275.  sub01 run01
## 3 feedback    24.0      2.03  NA   sub01 run01
## 4 translation 26.1      4.08  58.6 sub01 run01
## 5 translation 31.5      3.23  58.6 sub01 run01
## 6 translation 35.9      3.11 112.  sub01 run01</code></pre>
<p>For each translation (navigation) event, the event table has a duration and and angle value. As we don’t have the raw navigation data, all we can do here is plot overview of the lengths and directions of the trajectories.</p>
<p>When working with actual data, we will have to make decisions about how to define a trajectory event and how to label it with an angle. This is particularly complex if participants travel in long paths with curves so that they navigate in multiple directions in a translation event. We might want to do some reading here to check how other people did this.</p>
<div id="trajectory-duration" class="section level3 hasAnchor" number="2.3.1">
<h3><span class="header-section-number">2.3.1</span> Trajectory duration<a href="example-data.html#trajectory-duration" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="example-data.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># we are only interested in the trajectory events </span></span>
<span id="cb40-2"><a href="example-data.html#cb40-2" aria-hidden="true" tabindex="-1"></a>trajectory_events <span class="ot">&lt;-</span> event_table_full <span class="sc">%&gt;%</span> <span class="fu">filter</span>(name <span class="sc">==</span> <span class="st">&quot;translation&quot;</span>)</span>
<span id="cb40-3"><a href="example-data.html#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="example-data.html#cb40-4" aria-hidden="true" tabindex="-1"></a><span class="co"># histogram of durations</span></span>
<span id="cb40-5"><a href="example-data.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trajectory_events, <span class="fu">aes</span>(<span class="at">x=</span>duration)) <span class="sc">+</span></span>
<span id="cb40-6"><a href="example-data.html#cb40-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_histogram</span>(<span class="at">bins=</span><span class="dv">30</span>) <span class="sc">+</span></span>
<span id="cb40-7"><a href="example-data.html#cb40-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(subID <span class="sc">~</span> run) <span class="sc">+</span></span>
<span id="cb40-8"><a href="example-data.html#cb40-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">ggtitle</span>(<span class="st">&quot;Duration of translation events&quot;</span>) <span class="sc">+</span></span>
<span id="cb40-9"><a href="example-data.html#cb40-9" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_cowplot</span>()</span></code></pre></div>
<p><img src="Hexadirectioal-analysis-pipeline_files/figure-html/trajectory_duration-1.png" width="672" /></p>
</div>
<div id="angular-sampling" class="section level3 hasAnchor" number="2.3.2">
<h3><span class="header-section-number">2.3.2</span> Angular Sampling<a href="example-data.html#angular-sampling" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>One thing we want to be sure of is that all trajectory directions were sampled somewhat evenly. To do visualize the angular sampling, we plot a polar histogram with 36 bins (10 degree width).</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="example-data.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="co"># make polar histogram across trajectory event angles</span></span>
<span id="cb41-2"><a href="example-data.html#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="fu">ggplot</span>(trajectory_events, <span class="fu">aes</span>(<span class="at">x=</span>angle)) <span class="sc">+</span></span>
<span id="cb41-3"><a href="example-data.html#cb41-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">coord_polar</span>() <span class="sc">+</span></span>
<span id="cb41-4"><a href="example-data.html#cb41-4" aria-hidden="true" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">limits =</span> <span class="fu">c</span>(<span class="dv">0</span>,<span class="dv">360</span>)) <span class="sc">+</span></span>
<span id="cb41-5"><a href="example-data.html#cb41-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">geom_freqpoly</span>(<span class="at">bins =</span> <span class="dv">36</span>) <span class="sc">+</span></span>
<span id="cb41-6"><a href="example-data.html#cb41-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">facet_grid</span>(subID <span class="sc">~</span> run) <span class="sc">+</span></span>
<span id="cb41-7"><a href="example-data.html#cb41-7" aria-hidden="true" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title =</span> <span class="st">&quot;Trajectory directions&quot;</span>) <span class="sc">+</span></span>
<span id="cb41-8"><a href="example-data.html#cb41-8" aria-hidden="true" tabindex="-1"></a>  <span class="fu">theme_minimal</span>()</span></code></pre></div>
<pre><code>## Warning: Removed 2 row(s) containing missing values (geom_path).</code></pre>
<p><img src="Hexadirectioal-analysis-pipeline_files/figure-html/ang_sampling_hist-1.png" width="672" /></p>
<p>We can also test statistically if our angular sampling deviates from uniformity using a Rayleigh’s test. This test is implemented below for the entire set of samples (i.e. collapsed across runs).</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="example-data.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Rayleigh test of uniformity</span></span>
<span id="cb43-2"><a href="example-data.html#cb43-2" aria-hidden="true" tabindex="-1"></a>circular<span class="sc">::</span><span class="fu">rayleigh.test</span>(<span class="fu">circular</span>(trajectory_events<span class="sc">$</span>angle, <span class="at">type=</span><span class="st">&quot;angles&quot;</span>, <span class="at">units =</span> <span class="st">&quot;degrees&quot;</span>))</span></code></pre></div>
<pre><code>## 
##        Rayleigh Test of Uniformity 
##        General Unimodal Alternative 
## 
## Test Statistic:  0.0378 
## P-value:  0.7299</code></pre>
</div>
</div>
<div id="fmri" class="section level2 hasAnchor" number="2.4">
<h2><span class="header-section-number">2.4</span> fMRI<a href="example-data.html#fmri" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="merge-images-of-each-run" class="section level3 hasAnchor" number="2.4.1">
<h3><span class="header-section-number">2.4.1</span> Merge images of each run<a href="example-data.html#merge-images-of-each-run" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We have two runs of fMRI data from a navigation task. Because the toolbox is built for SPM, each volume is a separate file. Because this is annoying, let’s merge the images of each run to one 4-D file.</p>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="example-data.html#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_sub <span class="cf">in</span> subjects){</span>
<span id="cb45-2"><a href="example-data.html#cb45-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_run <span class="cf">in</span> runs){</span>
<span id="cb45-3"><a href="example-data.html#cb45-3" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-4"><a href="example-data.html#cb45-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create folder for 4D images if necessary</span></span>
<span id="cb45-5"><a href="example-data.html#cb45-5" aria-hidden="true" tabindex="-1"></a>    fmri_4d_dir <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;4D&quot;</span>, i_sub, i_run)</span>
<span id="cb45-6"><a href="example-data.html#cb45-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(fmri_4d_dir)){<span class="fu">dir.create</span>(fmri_4d_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)} </span>
<span id="cb45-7"><a href="example-data.html#cb45-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb45-8"><a href="example-data.html#cb45-8" aria-hidden="true" tabindex="-1"></a>    <span class="co"># merge the individual niftis into 4D timeseries</span></span>
<span id="cb45-9"><a href="example-data.html#cb45-9" aria-hidden="true" tabindex="-1"></a>    fn <span class="ot">&lt;-</span> <span class="fu">file.path</span>(fmri_4d_dir, <span class="fu">paste0</span>(i_run, <span class="st">&quot;.nii.gz&quot;</span>))</span>
<span id="cb45-10"><a href="example-data.html#cb45-10" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(fn)){</span>
<span id="cb45-11"><a href="example-data.html#cb45-11" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb45-12"><a href="example-data.html#cb45-12" aria-hidden="true" tabindex="-1"></a>      <span class="co"># find all the files and merge them using fslmerge</span></span>
<span id="cb45-13"><a href="example-data.html#cb45-13" aria-hidden="true" tabindex="-1"></a>      in_files <span class="ot">&lt;-</span> <span class="fu">dir</span>(<span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;3D&quot;</span>, i_sub, i_run), </span>
<span id="cb45-14"><a href="example-data.html#cb45-14" aria-hidden="true" tabindex="-1"></a>                      <span class="at">full.names =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-15"><a href="example-data.html#cb45-15" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fslmerge</span>(in_files, <span class="at">outfile =</span> fn,</span>
<span id="cb45-16"><a href="example-data.html#cb45-16" aria-hidden="true" tabindex="-1"></a>               <span class="at">retimg =</span> <span class="cn">FALSE</span>, <span class="at">direction =</span> <span class="st">&quot;t&quot;</span>, <span class="at">verbose =</span> <span class="cn">FALSE</span>)</span>
<span id="cb45-17"><a href="example-data.html#cb45-17" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb45-18"><a href="example-data.html#cb45-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># let&#39;s have a look at the first volume of the 4D image</span></span>
<span id="cb45-19"><a href="example-data.html#cb45-19" aria-hidden="true" tabindex="-1"></a>      run_nii <span class="ot">&lt;-</span> <span class="fu">readNIfTI2</span>(fn)</span>
<span id="cb45-20"><a href="example-data.html#cb45-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ortho2</span>(run_nii[,,,<span class="dv">1</span>], <span class="at">add.orient =</span> <span class="cn">TRUE</span>)</span>
<span id="cb45-21"><a href="example-data.html#cb45-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb45-22"><a href="example-data.html#cb45-22" aria-hidden="true" tabindex="-1"></a>    <span class="co">#system(sprintf(&quot;fslmerge -tr %s %s 1.5&quot;, fn, fn))</span></span>
<span id="cb45-23"><a href="example-data.html#cb45-23" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb45-24"><a href="example-data.html#cb45-24" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="calculate-tsnr" class="section level3 hasAnchor" number="2.4.2">
<h3><span class="header-section-number">2.4.2</span> Calculate tSNR<a href="example-data.html#calculate-tsnr" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="example-data.html#cb46-1" aria-hidden="true" tabindex="-1"></a>calc_tSNR <span class="ot">&lt;-</span> <span class="cf">function</span>(<span class="at">fourD_fn=</span><span class="cn">NULL</span>, <span class="at">tMean_fn=</span><span class="cn">NULL</span>, <span class="at">tStd_fn=</span><span class="cn">NULL</span>, <span class="at">tSNR_fn=</span><span class="cn">NULL</span>){</span>
<span id="cb46-2"><a href="example-data.html#cb46-2" aria-hidden="true" tabindex="-1"></a>  </span>
<span id="cb46-3"><a href="example-data.html#cb46-3" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate temporal mean for each voxel</span></span>
<span id="cb46-4"><a href="example-data.html#cb46-4" aria-hidden="true" tabindex="-1"></a>  fslr<span class="sc">::</span><span class="fu">fsl_maths</span>(<span class="at">file =</span> fourD_fn, <span class="at">opts =</span> <span class="st">&quot;-Tmean&quot;</span>, <span class="at">outfile =</span> tMean_fn,</span>
<span id="cb46-5"><a href="example-data.html#cb46-5" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">retimg =</span> <span class="cn">FALSE</span>)</span>
<span id="cb46-6"><a href="example-data.html#cb46-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate temporal mean for each voxel</span></span>
<span id="cb46-7"><a href="example-data.html#cb46-7" aria-hidden="true" tabindex="-1"></a>  fslr<span class="sc">::</span><span class="fu">fsl_maths</span>(<span class="at">file =</span> fourD_fn, <span class="at">opts =</span> <span class="st">&quot;-Tstd&quot;</span>, <span class="at">outfile =</span> tStd_fn,</span>
<span id="cb46-8"><a href="example-data.html#cb46-8" aria-hidden="true" tabindex="-1"></a>                  <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">retimg =</span> <span class="cn">FALSE</span>)</span>
<span id="cb46-9"><a href="example-data.html#cb46-9" aria-hidden="true" tabindex="-1"></a>  <span class="co"># calculate tSNR for each voxel</span></span>
<span id="cb46-10"><a href="example-data.html#cb46-10" aria-hidden="true" tabindex="-1"></a>  fslr<span class="sc">::</span><span class="fu">fsl_div</span>(<span class="at">file =</span> tMean_fn, <span class="at">file2 =</span> tStd_fn, <span class="at">outfile =</span> tSNR_fn,</span>
<span id="cb46-11"><a href="example-data.html#cb46-11" aria-hidden="true" tabindex="-1"></a>                <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">retimg =</span> <span class="cn">FALSE</span>)</span>
<span id="cb46-12"><a href="example-data.html#cb46-12" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb46-13"><a href="example-data.html#cb46-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-14"><a href="example-data.html#cb46-14" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_sub <span class="cf">in</span> subjects){</span>
<span id="cb46-15"><a href="example-data.html#cb46-15" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_run <span class="cf">in</span> runs){</span>
<span id="cb46-16"><a href="example-data.html#cb46-16" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb46-17"><a href="example-data.html#cb46-17" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create folder for SNR images if necessary</span></span>
<span id="cb46-18"><a href="example-data.html#cb46-18" aria-hidden="true" tabindex="-1"></a>    snr_dir <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;snr&quot;</span>, i_sub, i_run)</span>
<span id="cb46-19"><a href="example-data.html#cb46-19" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(snr_dir)){<span class="fu">dir.create</span>(snr_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)} </span>
<span id="cb46-20"><a href="example-data.html#cb46-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb46-21"><a href="example-data.html#cb46-21" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(<span class="fu">file.path</span>(snr_dir, <span class="st">&quot;tSNR.nii.gz&quot;</span>))){</span>
<span id="cb46-22"><a href="example-data.html#cb46-22" aria-hidden="true" tabindex="-1"></a>      <span class="co"># calculate tSNR</span></span>
<span id="cb46-23"><a href="example-data.html#cb46-23" aria-hidden="true" tabindex="-1"></a>      <span class="fu">calc_tSNR</span>(<span class="at">fourD_fn =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;4D&quot;</span>, </span>
<span id="cb46-24"><a href="example-data.html#cb46-24" aria-hidden="true" tabindex="-1"></a>                                i_sub, i_run, <span class="fu">paste0</span>(i_run, <span class="st">&quot;.nii.gz&quot;</span>)),</span>
<span id="cb46-25"><a href="example-data.html#cb46-25" aria-hidden="true" tabindex="-1"></a>                <span class="at">tMean_fn =</span> <span class="fu">file.path</span>(snr_dir, <span class="st">&quot;tMean.nii.gz&quot;</span>), </span>
<span id="cb46-26"><a href="example-data.html#cb46-26" aria-hidden="true" tabindex="-1"></a>                <span class="at">tStd_fn =</span> <span class="fu">file.path</span>(snr_dir, <span class="st">&quot;tStd.nii.gz&quot;</span>), </span>
<span id="cb46-27"><a href="example-data.html#cb46-27" aria-hidden="true" tabindex="-1"></a>                <span class="at">tSNR_fn =</span> <span class="fu">file.path</span>(snr_dir, <span class="st">&quot;tSNR.nii.gz&quot;</span>))</span>
<span id="cb46-28"><a href="example-data.html#cb46-28" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb46-29"><a href="example-data.html#cb46-29" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb46-30"><a href="example-data.html#cb46-30" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="create-quick-brain-mask" class="section level3 hasAnchor" number="2.4.3">
<h3><span class="header-section-number">2.4.3</span> Create quick brain mask<a href="example-data.html#create-quick-brain-mask" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To speed up the GLM, let’s quickly create a brain mask based on the temporal mean image that we can use to mask the functional images. After eye-balling the image, we use a value of 100 to create the mask.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="example-data.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_sub <span class="cf">in</span> subjects){</span>
<span id="cb47-2"><a href="example-data.html#cb47-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_run <span class="cf">in</span> runs){</span>
<span id="cb47-3"><a href="example-data.html#cb47-3" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb47-4"><a href="example-data.html#cb47-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create folder for mask images if necessary</span></span>
<span id="cb47-5"><a href="example-data.html#cb47-5" aria-hidden="true" tabindex="-1"></a>    mask_dir <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;brain_mask&quot;</span>, i_sub, i_run)</span>
<span id="cb47-6"><a href="example-data.html#cb47-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">dir.exists</span>(mask_dir)){<span class="fu">dir.create</span>(mask_dir, <span class="at">recursive =</span> <span class="cn">TRUE</span>)}</span>
<span id="cb47-7"><a href="example-data.html#cb47-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb47-8"><a href="example-data.html#cb47-8" aria-hidden="true" tabindex="-1"></a>    mask_fn <span class="ot">&lt;-</span> <span class="fu">file.path</span>(mask_dir, <span class="st">&quot;brain_mask_tMean100.nii.gz&quot;</span>)</span>
<span id="cb47-9"><a href="example-data.html#cb47-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(mask_fn)){</span>
<span id="cb47-10"><a href="example-data.html#cb47-10" aria-hidden="true" tabindex="-1"></a>      mask_nii <span class="ot">&lt;-</span> <span class="fu">fslthresh</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;snr&quot;</span>, i_sub, i_run, <span class="st">&quot;tMean.nii.gz&quot;</span>),</span>
<span id="cb47-11"><a href="example-data.html#cb47-11" aria-hidden="true" tabindex="-1"></a>                            <span class="at">outfile =</span> mask_fn,</span>
<span id="cb47-12"><a href="example-data.html#cb47-12" aria-hidden="true" tabindex="-1"></a>                            <span class="at">thresh =</span> <span class="dv">100</span>, <span class="at">opts =</span> <span class="st">&quot;-bin&quot;</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb47-13"><a href="example-data.html#cb47-13" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ortho2</span>(mask_nii)</span>
<span id="cb47-14"><a href="example-data.html#cb47-14" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb47-15"><a href="example-data.html#cb47-15" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb47-16"><a href="example-data.html#cb47-16" aria-hidden="true" tabindex="-1"></a>  <span class="co"># create a joint mask</span></span>
<span id="cb47-17"><a href="example-data.html#cb47-17" aria-hidden="true" tabindex="-1"></a>  <span class="co"># the code below will only work correctly for two runs!</span></span>
<span id="cb47-18"><a href="example-data.html#cb47-18" aria-hidden="true" tabindex="-1"></a>  mask_fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;brain_mask&quot;</span>, i_sub, runs, <span class="st">&quot;brain_mask_tMean100.nii.gz&quot;</span>)</span>
<span id="cb47-19"><a href="example-data.html#cb47-19" aria-hidden="true" tabindex="-1"></a>  <span class="fu">fslmul</span>(mask_fn[<span class="dv">1</span>], mask_fn[<span class="dv">2</span>], </span>
<span id="cb47-20"><a href="example-data.html#cb47-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">outfile =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;brain_mask&quot;</span>, i_sub, <span class="st">&quot;comb_brain_mask_tMean100.nii.gz&quot;</span>),</span>
<span id="cb47-21"><a href="example-data.html#cb47-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">retimg =</span> <span class="cn">FALSE</span>, <span class="at">verbose=</span><span class="cn">FALSE</span>)</span>
<span id="cb47-22"><a href="example-data.html#cb47-22" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>
</div>
<div id="mask-4d-functionals" class="section level3 hasAnchor" number="2.4.4">
<h3><span class="header-section-number">2.4.4</span> Mask 4D functionals<a href="example-data.html#mask-4d-functionals" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>To speed up the GLM, we use the mask created above to mask out non-brain voxels from the functional images.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="example-data.html#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> (i_sub <span class="cf">in</span> subjects){</span>
<span id="cb48-2"><a href="example-data.html#cb48-2" aria-hidden="true" tabindex="-1"></a>  <span class="cf">for</span> (i_run <span class="cf">in</span> runs){</span>
<span id="cb48-3"><a href="example-data.html#cb48-3" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb48-4"><a href="example-data.html#cb48-4" aria-hidden="true" tabindex="-1"></a>    <span class="co"># create folder for mask images if necessary</span></span>
<span id="cb48-5"><a href="example-data.html#cb48-5" aria-hidden="true" tabindex="-1"></a>    func4d_dir <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;4D&quot;</span>, i_sub, i_run)</span>
<span id="cb48-6"><a href="example-data.html#cb48-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-7"><a href="example-data.html#cb48-7" aria-hidden="true" tabindex="-1"></a>    masked4D_fn <span class="ot">&lt;-</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;4D&quot;</span>, i_sub, i_run, </span>
<span id="cb48-8"><a href="example-data.html#cb48-8" aria-hidden="true" tabindex="-1"></a>                        <span class="fu">paste0</span>(i_run, <span class="st">&quot;_masked.nii.gz&quot;</span>))</span>
<span id="cb48-9"><a href="example-data.html#cb48-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> (<span class="sc">!</span><span class="fu">file.exists</span>(masked4D_fn)){</span>
<span id="cb48-10"><a href="example-data.html#cb48-10" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb48-11"><a href="example-data.html#cb48-11" aria-hidden="true" tabindex="-1"></a>      <span class="fu">fslmask</span>(<span class="at">file =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;FunctionalScans&quot;</span>, <span class="st">&quot;4D&quot;</span>, i_sub, i_run, </span>
<span id="cb48-12"><a href="example-data.html#cb48-12" aria-hidden="true" tabindex="-1"></a>                          <span class="fu">paste0</span>(i_run, <span class="st">&quot;.nii.gz&quot;</span>)),</span>
<span id="cb48-13"><a href="example-data.html#cb48-13" aria-hidden="true" tabindex="-1"></a>              <span class="at">mask =</span> <span class="fu">here</span>(<span class="st">&quot;data&quot;</span>, <span class="st">&quot;masks&quot;</span>, <span class="st">&quot;brain_mask&quot;</span>, i_sub, i_run,</span>
<span id="cb48-14"><a href="example-data.html#cb48-14" aria-hidden="true" tabindex="-1"></a>                          <span class="st">&quot;brain_mask_tMean100.nii.gz&quot;</span>),</span>
<span id="cb48-15"><a href="example-data.html#cb48-15" aria-hidden="true" tabindex="-1"></a>              <span class="at">outfile =</span> masked4D_fn,</span>
<span id="cb48-16"><a href="example-data.html#cb48-16" aria-hidden="true" tabindex="-1"></a>              <span class="at">verbose =</span> <span class="cn">FALSE</span>, <span class="at">retimg =</span> <span class="cn">FALSE</span>)</span>
<span id="cb48-17"><a href="example-data.html#cb48-17" aria-hidden="true" tabindex="-1"></a>      </span>
<span id="cb48-18"><a href="example-data.html#cb48-18" aria-hidden="true" tabindex="-1"></a>      <span class="co"># let&#39;s have a look at the first volume of the resulting masked 4D image</span></span>
<span id="cb48-19"><a href="example-data.html#cb48-19" aria-hidden="true" tabindex="-1"></a>      run_nii <span class="ot">&lt;-</span> <span class="fu">readNIfTI2</span>(masked4D_fn)</span>
<span id="cb48-20"><a href="example-data.html#cb48-20" aria-hidden="true" tabindex="-1"></a>      <span class="fu">ortho2</span>(run_nii[,,,<span class="dv">1</span>], <span class="at">add.orient =</span> <span class="cn">TRUE</span>)</span>
<span id="cb48-21"><a href="example-data.html#cb48-21" aria-hidden="true" tabindex="-1"></a>    }</span>
<span id="cb48-22"><a href="example-data.html#cb48-22" aria-hidden="true" tabindex="-1"></a>  }</span>
<span id="cb48-23"><a href="example-data.html#cb48-23" aria-hidden="true" tabindex="-1"></a>}</span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="index.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="glm-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": null,
"text": null
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
